<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Attendance & Fee Management System</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --accent: #e74c3c;
            --success: #2ecc71;
            --warning: #f39c12;
            --light: #ecf0f1;
            --dark: #2c3e50;
            --gray: #95a5a6;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: var(--dark);
            line-height: 1.6;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* Header Styles */
        header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 20px 0;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
            position: relative;
            overflow: hidden;
            animation: headerSlide 0.8s ease-out;
        }
        
        @keyframes headerSlide {
            from { transform: translateY(-100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
            position: relative;
            z-index: 2;
        }
        
        .institute-info {
            text-align: center;
            flex-grow: 1;
        }
        
        .institute-name {
            font-size: 28px;
            font-weight: bold;
            margin-bottom: 5px;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.2);
        }
        
        .institute-address {
            font-size: 14px;
            opacity: 0.9;
        }
        
        .real-time-clock {
            position: absolute;
            top: 10px;
            right: 20px;
            background: rgba(255, 255, 255, 0.2);
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
            backdrop-filter: blur(5px);
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(255, 255, 255, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(255, 255, 255, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 255, 255, 0); }
        }
        
        .teacher-access {
            display: flex;
            align-items: center;
            gap: 10px;
            background: rgba(255, 255, 255, 0.2);
            padding: 8px 15px;
            border-radius: 30px;
            backdrop-filter: blur(5px);
        }
        
        .teacher-access input {
            background: transparent;
            border: none;
            border-bottom: 1px solid white;
            color: white;
            padding: 5px;
            width: 120px;
            transition: var(--transition);
        }
        
        .teacher-access input::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }
        
        .teacher-access input:focus {
            outline: none;
            border-bottom: 1px solid var(--warning);
        }
        
        .teacher-access button {
            background: var(--warning);
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: var(--transition);
        }
        
        .teacher-access button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .date-selector {
            display: flex;
            align-items: center;
            gap: 10px;
            background: rgba(255, 255, 255, 0.2);
            padding: 8px 15px;
            border-radius: 30px;
            backdrop-filter: blur(5px);
        }
        
        .date-selector input {
            background: transparent;
            border: none;
            color: white;
            font-size: 16px;
            width: 150px;
        }
        
        .date-selector input:focus {
            outline: none;
        }
        
        /* Main Content */
        .main-content {
            display: grid;
            grid-template-columns: 280px 1fr;
            gap: 20px;
            animation: contentFade 0.8s ease-out;
        }
        
        @keyframes contentFade {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .sidebar {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: var(--shadow);
            display: flex;
            flex-direction: column;
            gap: 20px;
            transition: var(--transition);
        }
        
        .sidebar:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        
        .teacher-controls {
            background: linear-gradient(135deg, var(--light), #d6e4f0);
            padding: 15px;
            border-radius: 12px;
            display: none;
            animation: slideInLeft 0.5s ease-out;
        }
        
        @keyframes slideInLeft {
            from { transform: translateX(-100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        .control-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .control-buttons {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .control-btn {
            padding: 10px 15px;
            background: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            text-align: left;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: var(--transition);
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .control-btn:hover {
            background: var(--secondary);
            color: white;
            transform: translateX(5px);
        }
        
        .control-btn.active {
            background: var(--secondary);
            color: white;
            box-shadow: 0 4px 8px rgba(52, 152, 219, 0.3);
        }
        
        .class-list {
            list-style: none;
        }
        
        .class-item {
            padding: 12px 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .class-item:hover {
            background-color: var(--light);
            transform: translateX(5px);
        }
        
        .class-item.active {
            background: linear-gradient(135deg, var(--secondary), #2980b9);
            color: white;
            box-shadow: 0 4px 8px rgba(52, 152, 219, 0.3);
        }
        
        .student-count {
            background: rgba(255, 255, 255, 0.2);
            padding: 2px 8px;
            border-radius: 20px;
            font-size: 12px;
        }
        
        /* Attendance Panel */
        .attendance-panel {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: var(--shadow);
            display: flex;
            flex-direction: column;
            transition: var(--transition);
        }
        
        .attendance-panel:hover {
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        
        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--light);
        }
        
        .class-title {
            font-size: 22px;
            font-weight: 600;
        }
        
        .attendance-stats {
            display: flex;
            gap: 15px;
        }
        
        .stat {
            text-align: center;
            padding: 10px 15px;
            border-radius: 8px;
            background: var(--light);
            transition: var(--transition);
        }
        
        .stat:hover {
            transform: translateY(-3px);
        }
        
        .stat.present {
            background: rgba(46, 204, 113, 0.2);
            color: var(--success);
        }
        
        .stat.absent {
            background: rgba(231, 76, 60, 0.2);
            color: var(--accent);
        }
        
        .stat.checked-out {
            background: rgba(52, 152, 219, 0.2);
            color: var(--secondary);
        }
        
        .student-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
            flex-grow: 1;
        }
        
        .student-card {
            background: white;
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            border: 1px solid var(--light);
            transition: var(--transition);
            display: flex;
            justify-content: space-between;
            align-items: center;
            animation: cardAppear 0.5s ease-out;
        }
        
        @keyframes cardAppear {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }
        
        .student-card.pending {
            border-left: 4px solid var(--warning);
            background: rgba(243, 156, 18, 0.05);
        }
        
        .student-card.present {
            border-left: 4px solid var(--success);
            background: rgba(46, 204, 113, 0.05);
        }
        
        .student-card.absent {
            border-left: 4px solid var(--accent);
        }
        
        .student-card.checked-out {
            border-left: 4px solid var(--secondary);
            background: rgba(52, 152, 219, 0.05);
        }
        
        .student-card.fee-due {
            border-left: 4px solid #e74c3c;
            background: rgba(231, 76, 60, 0.05);
            animation: pulse 2s infinite;
        }
        
        .student-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1);
        }
        
        .student-info {
            display: flex;
            align-items: center;
            flex-grow: 1;
        }
        
        .student-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--secondary), #2980b9);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            margin-right: 15px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .student-details {
            display: flex;
            flex-direction: column;
            flex-grow: 1;
        }
        
        .student-name {
            font-weight: 600;
            font-size: 16px;
        }
        
        .student-id {
            font-size: 12px;
            color: var(--gray);
        }
        
        .contact-info {
            font-size: 11px;
            color: var(--gray);
            margin-top: 3px;
        }
        
        .attendance-time {
            font-size: 10px;
            color: var(--gray);
            margin-top: 3px;
        }
        
        .fee-status {
            font-size: 10px;
            margin-top: 3px;
            font-weight: bold;
        }
        
        .fee-status.paid {
            color: var(--success);
        }
        
        .fee-status.due {
            color: var(--accent);
        }
        
        .attendance-toggle {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .toggle-label {
            font-size: 14px;
            color: var(--gray);
            min-width: 60px;
            text-align: center;
        }
        
        .attendance-options {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .attendance-option {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 12px;
        }
        
        .attendance-checkbox {
            width: 16px;
            height: 16px;
            cursor: pointer;
        }
        
        .present-checkbox {
            accent-color: var(--success);
        }
        
        .absent-checkbox {
            accent-color: var(--accent);
        }
        
        .student-self-attendance {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 20px;
            padding: 20px;
            background: linear-gradient(135deg, var(--light), #d6e4f0);
            border-radius: 12px;
            animation: slideInUp 0.5s ease-out;
        }
        
        @keyframes slideInUp {
            from { transform: translateY(100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .self-attendance-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 10px;
        }
        
        .search-container {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .search-input {
            flex: 1;
            padding: 10px 15px;
            border: 1px solid var(--gray);
            border-radius: 8px;
            font-size: 16px;
            transition: var(--transition);
        }
        
        .search-input:focus {
            outline: none;
            border-color: var(--secondary);
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
        }
        
        .rollno-container {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .rollno-input {
            flex: 1;
            padding: 10px 15px;
            border: 1px solid var(--gray);
            border-radius: 8px;
            font-size: 16px;
            transition: var(--transition);
        }
        
        .rollno-input:focus {
            outline: none;
            border-color: var(--secondary);
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
        }
        
        .student-select {
            padding: 10px 15px;
            border: 1px solid var(--gray);
            border-radius: 8px;
            font-size: 16px;
            margin-bottom: 10px;
            transition: var(--transition);
        }
        
        .self-attendance-btn {
            padding: 12px 20px;
            background: linear-gradient(135deg, var(--success), #27ae60);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            font-size: 16px;
            transition: var(--transition);
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .self-attendance-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }
        
        .self-attendance-btn:disabled {
            background: var(--gray);
            cursor: not-allowed;
            transform: none;
        }
        
        .quick-attendance-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }
        
        .quick-btn {
            padding: 10px 15px;
            background: linear-gradient(135deg, var(--success), #27ae60);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            text-align: center;
            transition: var(--transition);
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .quick-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }
        
        .checkout-btn {
            padding: 10px 15px;
            background: linear-gradient(135deg, var(--secondary), #2980b9);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            text-align: center;
            transition: var(--transition);
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .checkout-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }
        
        .student-found {
            background: rgba(46, 204, 113, 0.1);
            border: 1px solid var(--success);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            display: none;
            animation: slideInRight 0.5s ease-out;
        }
        
        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        .student-found-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .mark-attendance-btn {
            padding: 8px 15px;
            background: linear-gradient(135deg, var(--success), #27ae60);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: var(--transition);
        }
        
        .mark-attendance-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .mark-checkout-btn {
            padding: 8px 15px;
            background: linear-gradient(135deg, var(--secondary), #2980b9);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: var(--transition);
            margin-left: 10px;
        }
        
        .mark-checkout-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .panel-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 20px;
        }
        
        .btn {
            padding: 10px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .btn-mark-attendance {
            background: linear-gradient(135deg, var(--success), #27ae60);
            color: white;
            font-size: 16px;
            padding: 12px 30px;
        }
        
        .btn-save {
            background: linear-gradient(135deg, var(--secondary), #2980b9);
            color: white;
        }
        
        .btn-reset {
            background: linear-gradient(135deg, var(--gray), #7f8c8d);
            color: white;
        }
        
        .btn-add {
            background: linear-gradient(135deg, var(--success), #27ae60);
            color: white;
        }
        
        .btn-remove {
            background: linear-gradient(135deg, var(--accent), #c0392b);
            color: white;
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }
        
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--gray);
            grid-column: 1 / -1;
        }
        
        .empty-state i {
            font-size: 48px;
            margin-bottom: 15px;
            display: block;
        }
        
        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            animation: modalFade 0.3s ease-out;
        }
        
        @keyframes modalFade {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .modal-content {
            background: white;
            border-radius: 15px;
            padding: 30px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            animation: modalSlide 0.3s ease-out;
        }
        
        @keyframes modalSlide {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .modal-title {
            font-size: 22px;
            font-weight: 600;
            color: var(--primary);
        }
        
        .close-modal {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--gray);
            transition: var(--transition);
        }
        
        .close-modal:hover {
            color: var(--accent);
            transform: rotate(90deg);
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
        }
        
        .form-input {
            width: 100%;
            padding: 10px 15px;
            border: 1px solid var(--light);
            border-radius: 8px;
            font-size: 16px;
            transition: var(--transition);
        }
        
        .form-input:focus {
            outline: none;
            border-color: var(--secondary);
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
        }
        
        .form-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 30px;
        }
        
        /* Report Container */
        .report-container {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: var(--shadow);
            margin-top: 20px;
            display: none;
            animation: slideInUp 0.5s ease-out;
        }
        
        .report-title {
            font-size: 22px;
            font-weight: 600;
            margin-bottom: 20px;
            color: var(--primary);
        }
        
        .report-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .report-table th, .report-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid var(--light);
        }
        
        .report-table th {
            background: var(--light);
            font-weight: 600;
        }
        
        /* Notifications */
        .attendance-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--success);
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: var(--shadow);
            z-index: 1001;
            display: none;
            animation: slideIn 0.3s ease;
        }
        
        .checkout-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--secondary);
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: var(--shadow);
            z-index: 1001;
            display: none;
            animation: slideIn 0.3s ease;
        }
        
        .email-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--warning);
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: var(--shadow);
            z-index: 1001;
            display: none;
            animation: slideIn 0.3s ease;
        }
        
        .fee-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #e74c3c;
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: var(--shadow);
            z-index: 1001;
            display: none;
            animation: slideIn 0.3s ease;
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        /* Teacher Approval Section */
        .teacher-approval-section {
            background: linear-gradient(135deg, var(--light), #d6e4f0);
            padding: 15px;
            border-radius: 12px;
            margin-top: 20px;
            display: none;
            animation: slideInUp 0.5s ease-out;
        }
        
        .approval-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            color: var(--primary);
        }
        
        .approval-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .approval-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            transition: var(--transition);
        }
        
        .approval-item:hover {
            transform: translateX(5px);
        }
        
        .approval-actions {
            display: flex;
            gap: 10px;
        }
        
        .approve-btn {
            padding: 5px 10px;
            background: linear-gradient(135deg, var(--success), #27ae60);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .approve-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .reject-btn {
            padding: 5px 10px;
            background: linear-gradient(135deg, var(--accent), #c0392b);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .reject-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        /* Fee Management Section */
        .fee-management-section {
            background: linear-gradient(135deg, var(--light), #d6e4f0);
            padding: 15px;
            border-radius: 12px;
            margin-top: 20px;
            display: none;
            animation: slideInUp 0.5s ease-out;
        }
        
        .fee-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            color: var(--primary);
        }
        
        .fee-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .fee-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .fee-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            transition: var(--transition);
        }
        
        .fee-item:hover {
            transform: translateX(5px);
        }
        
        .fee-actions {
            display: flex;
            gap: 10px;
        }
        
        .mark-paid-btn {
            padding: 5px 10px;
            background: linear-gradient(135deg, var(--success), #27ae60);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .mark-paid-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .send-reminder-btn {
            padding: 5px 10px;
            background: linear-gradient(135deg, var(--warning), #d35400);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .send-reminder-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .set-fee-btn {
            padding: 5px 10px;
            background: linear-gradient(135deg, #9b59b6, #8e44ad);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .set-fee-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        /* Teacher Panel Controls */
        .teacher-panel-controls {
            position: fixed;
            top: 50%;
            right: 0;
            transform: translateY(-50%);
            background: white;
            border-radius: 10px 0 0 10px;
            box-shadow: -2px 0 10px rgba(0,0,0,0.1);
            z-index: 999;
            display: flex;
            flex-direction: column;
            padding: 10px;
            gap: 10px;
            display: none;
        }
        
        .teacher-panel-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--secondary);
            color: white;
            border: none;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        
        .teacher-panel-btn:hover {
            transform: scale(1.1);
        }
        
        /* Fee Summary Styles */
        .fee-summary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .summary-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }
        
        .summary-stat {
            text-align: center;
            padding: 15px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            backdrop-filter: blur(10px);
        }
        
        .summary-stat .stat-value {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .summary-stat .stat-label {
            font-size: 14px;
            opacity: 0.9;
        }
        
        .fee-due-badge {
            background: #e74c3c;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: absolute;
            top: -5px;
            right: -5px;
        }
        
        /* Form Row for side-by-side inputs */
        .form-row {
            display: flex;
            gap: 15px;
        }
        
        .form-row .form-group {
            flex: 1;
        }
        
        /* QR Code Styles */
        .qr-code-container {
            text-align: center;
            padding: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            margin: 20px 0;
        }
        
        .qr-code {
            margin: 0 auto;
            max-width: 200px;
        }
        
        .payment-details {
            margin-top: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            text-align: left;
        }
        
        .payment-details h4 {
            margin-bottom: 10px;
            color: var(--primary);
        }
        
        .payment-details p {
            margin: 5px 0;
        }
        
        .payment-info {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
        }
        
        /* Data Management Section */
        .data-management-section {
            background: linear-gradient(135deg, var(--light), #d6e4f0);
            padding: 15px;
            border-radius: 12px;
            margin-top: 20px;
            display: none;
            animation: slideInUp 0.5s ease-out;
        }
        
        .data-management-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            color: var(--primary);
        }
        
        .data-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        /* Face Recognition Section */
        .face-recognition-section {
            background: linear-gradient(135deg, var(--light), #d6e4f0);
            padding: 15px;
            border-radius: 12px;
            margin-top: 20px;
            display: none;
            animation: slideInUp 0.5s ease-out;
        }
        
        .face-recognition-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            color: var(--primary);
        }
        
        .video-container {
            position: relative;
            width: 100%;
            max-width: 500px;
            margin: 0 auto 15px;
        }
        
        #videoElement {
            width: 100%;
            height: auto;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            background: #000;
        }
        
        .face-recognition-controls {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .face-recognition-btn {
            padding: 10px 15px;
            background: linear-gradient(135deg, var(--secondary), #2980b9);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: var(--transition);
        }
        
        .face-recognition-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }
        
        .face-recognition-btn:disabled {
            background: var(--gray);
            cursor: not-allowed;
            transform: none;
        }
        
        .face-recognition-status {
            padding: 10px;
            border-radius: 8px;
            margin-top: 10px;
            text-align: center;
            font-weight: bold;
        }
        
        .face-recognition-status.recognizing {
            background: rgba(243, 156, 18, 0.2);
            color: var(--warning);
        }
        
        .face-recognition-status.success {
            background: rgba(46, 204, 113, 0.2);
            color: var(--success);
        }
        
        .face-recognition-status.error {
            background: rgba(231, 76, 60, 0.2);
            color: var(--accent);
        }
        
        .face-training-section {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .face-training-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            flex-wrap: wrap;
        }
        
        .face-training-btn {
            padding: 8px 12px;
            background: linear-gradient(135deg, var(--success), #27ae60);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .face-training-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .face-training-btn:disabled {
            background: var(--gray);
            cursor: not-allowed;
            transform: none;
        }
        
        .captured-faces {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }
        
        .captured-face {
            width: 100px;
            height: 100px;
            border-radius: 8px;
            overflow: hidden;
            position: relative;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .captured-face img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .captured-face .remove-face {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(231, 76, 60, 0.8);
            color: white;
            border: none;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* Canvas for face detection */
        #overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .header-content {
                flex-direction: column;
                gap: 15px;
            }
            
            .real-time-clock {
                position: static;
                margin-top: 10px;
            }
            
            .student-list {
                grid-template-columns: 1fr;
            }
            
            .student-card {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
            
            .attendance-toggle {
                align-self: flex-end;
            }
            
            .search-container, .rollno-container {
                flex-direction: column;
            }
            
            .quick-attendance-buttons {
                grid-template-columns: 1fr;
            }
            
            .teacher-panel-controls {
                display: none !important;
            }
            
            .fee-controls {
                flex-direction: column;
            }
            
            .summary-stats {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .form-row {
                flex-direction: column;
                gap: 0;
            }
            
            .face-training-controls {
                flex-direction: column;
            }
            
            .captured-face {
                width: 80px;
                height: 80px;
            }
        }
    </style>
</head>
<body>
    <!-- Notifications -->
    <div class="attendance-notification" id="attendanceNotification"></div>
    <div class="checkout-notification" id="checkoutNotification"></div>
    <div class="email-notification" id="emailNotification"></div>
    <div class="fee-notification" id="feeNotification"></div>
    
    <!-- Teacher Panel Controls -->
    <div class="teacher-panel-controls" id="teacherPanelControls">
        <button class="teacher-panel-btn" id="toggleTeacherPanel" title="Toggle Teacher Panel">
            <i class="fas fa-chalkboard-teacher"></i>
        </button>
        <button class="teacher-panel-btn" id="toggleApprovals" title="Toggle Approvals">
            <i class="fas fa-clipboard-check"></i>
        </button>
        <button class="teacher-panel-btn" id="toggleFeeManagement" title="Toggle Fee Management">
            <i class="fas fa-money-bill-wave"></i>
        </button>
        <button class="teacher-panel-btn" id="toggleReports" title="Toggle Reports">
            <i class="fas fa-chart-bar"></i>
        </button>
    </div>
    
    <div class="container">
        <header>
            <div class="real-time-clock" id="realTimeClock"></div>
            <div class="header-content">
                <div class="institute-info">
                    <div class="institute-name">Ai Tech Institute & Higher Education</div>
                    <div class="institute-address">Murdaha Bazar, Varanasi - 221202</div>
                </div>
                <div class="teacher-access">
                    <input type="password" id="teacherPassword" placeholder="Teacher Password">
                    <button id="loginBtn">Login</button>
                </div>
                <div class="date-selector">
                    <span>ðŸ“…</span>
                    <input type="date" id="attendance-date" value="">
                </div>
            </div>
        </header>
        
        <div class="main-content">
            <div class="sidebar">
                <div class="teacher-controls" id="teacherControls">
                    <div class="control-title"><i class="fas fa-chalkboard-teacher"></i> Teacher Controls</div>
                    <div class="control-buttons">
                        <button class="control-btn active" id="btn-attendance">
                            <i class="fas fa-check-circle"></i> Mark Attendance
                        </button>
                        <button class="control-btn" id="btn-add-student">
                            <i class="fas fa-user-plus"></i> Add Student
                        </button>
                        <button class="control-btn" id="btn-remove-student">
                            <i class="fas fa-user-times"></i> Remove Student
                        </button>
                        <button class="control-btn" id="btn-view-reports">
                            <i class="fas fa-chart-bar"></i> View Reports
                        </button>
                        <button class="control-btn" id="btn-pending-approvals">
                            <i class="fas fa-clipboard-check"></i> Pending Approvals
                            <span class="student-count" id="pendingCount">0</span>
                        </button>
                        <button class="control-btn" id="btn-fee-management">
                            <i class="fas fa-money-bill-wave"></i> Fee Management
                            <span class="student-count" id="feeDueCount">0</span>
                        </button>
                        <button class="control-btn" id="btn-face-recognition">
                            <i class="fas fa-camera"></i> Face Recognition
                        </button>
                        <button class="control-btn" id="btn-data-management">
                            <i class="fas fa-database"></i> Data Management
                        </button>
                    </div>
                </div>
                
                <div>
                    <h3><i class="fas fa-book-open"></i> Courses</h3>
                    <ul class="class-list">
                        <li class="class-item active" data-class="o-level">
                            <span>'O' Level</span>
                            <span class="student-count">0</span>
                        </li>
                        <li class="class-item" data-class="adca">
                            <span>ADCA</span>
                            <span class="student-count">0</span>
                        </li>
                        <li class="class-item" data-class="ccc">
                            <span>CCC</span>
                            <span class="student-count">0</span>
                        </li>
                    </ul>
                </div>
            </div>
            
            <div class="attendance-panel">
                <div class="panel-header">
                    <div class="class-title">'O' Level Course - Student Self-Attendance</div>
                    <div class="attendance-stats">
                        <div class="stat present">
                            <div class="stat-value" id="presentCount">0</div>
                            <div class="stat-label">Present</div>
                        </div>
                        <div class="stat absent">
                            <div class="stat-value" id="absentCount">0</div>
                            <div class="stat-label">Absent</div>
                        </div>
                        <div class="stat checked-out">
                            <div class="stat-value" id="checkedOutCount">0</div>
                            <div class="stat-label">Checked Out</div>
                        </div>
                    </div>
                </div>
                
                <div class="student-list" id="student-list">
                    <!-- Student cards will be dynamically generated here -->
                </div>
                
                <!-- Face Recognition Section -->
                <div class="face-recognition-section" id="faceRecognitionSection">
                    <div class="face-recognition-title"><i class="fas fa-camera"></i> Face Recognition Attendance</div>
                    
                    <div class="video-container">
                        <video id="videoElement" autoplay muted playsinline></video>
                        <canvas id="overlay"></canvas>
                    </div>
                    
                    <div class="face-recognition-controls">
                        <button class="face-recognition-btn" id="startFaceRecognition">Start Face Recognition</button>
                        <button class="face-recognition-btn" id="stopFaceRecognition" disabled>Stop Recognition</button>
                        <button class="face-recognition-btn" id="trainFaceModel">Train Face Model</button>
                    </div>
                    
                    <div class="face-recognition-status" id="faceRecognitionStatus">
                        Face recognition is not active
                    </div>
                    
                    <div class="face-training-section" id="faceTrainingSection">
                        <div class="face-recognition-title"><i class="fas fa-user-graduate"></i> Face Training</div>
                        <div class="face-training-controls">
                            <select id="studentSelectForTraining" class="form-input">
                                <!-- Options will be populated dynamically -->
                            </select>
                            <button class="face-training-btn" id="captureFace">Capture Face</button>
                            <button class="face-training-btn" id="clearFaces">Clear All Faces</button>
                        </div>
                        <div class="captured-faces" id="capturedFaces">
                            <!-- Captured face images will be displayed here -->
                        </div>
                    </div>
                </div>
                
                <div class="teacher-approval-section" id="teacherApprovalSection">
                    <div class="approval-title"><i class="fas fa-clipboard-check"></i> Pending Attendance Approvals</div>
                    <div class="approval-list" id="approvalList">
                        <!-- Pending approvals will be added here -->
                    </div>
                </div>
                
                <div class="fee-management-section" id="feeManagementSection">
                    <div class="fee-summary" id="feeSummary">
                        <div class="summary-stats">
                            <div class="summary-stat">
                                <div class="stat-value" id="totalStudents">0</div>
                                <div class="stat-label">Total Students</div>
                            </div>
                            <div class="summary-stat">
                                <div class="stat-value" id="paidStudents">0</div>
                                <div class="stat-label">Fee Paid</div>
                            </div>
                            <div class="summary-stat">
                                <div class="stat-value" id="dueStudents">0</div>
                                <div class="stat-label">Fee Due</div>
                            </div>
                            <div class="summary-stat">
                                <div class="stat-value" id="totalRevenue">â‚¹0</div>
                                <div class="stat-label">Total Revenue</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="fee-title"><i class="fas fa-money-bill-wave"></i> Fee Management</div>
                    <div class="fee-controls">
                        <button class="btn" id="setFeeDate">Set Fee Due Date</button>
                        <button class="btn" id="setIndividualFees">Set Individual Fees</button>
                        <button class="btn" id="sendFeeReminders">Send Fee Reminders</button>
                        <button class="btn" id="generateQRCode">Generate Payment QR</button>
                    </div>
                    <div class="fee-list" id="feeList">
                        <!-- Fee items will be added here -->
                    </div>
                </div>
                
                <div class="data-management-section" id="dataManagementSection">
                    <div class="data-management-title"><i class="fas fa-database"></i> Data Management</div>
                    <div class="data-controls">
                        <button class="btn" id="clearAllData">Clear All Student Data</button>
                        <button class="btn" id="exportData">Export Data</button>
                        <button class="btn" id="importData">Import Data</button>
                    </div>
                    <div class="fee-list" id="dataList">
                        <!-- Data management info will be added here -->
                    </div>
                </div>
                
                <div class="student-self-attendance">
                    <div class="self-attendance-title"><i class="fas fa-user-check"></i> Quick Self-Attendance Options</div>
                    
                    <!-- Search by Name -->
                    <div class="search-container">
                        <input type="text" class="search-input" id="searchName" placeholder="Search by your name...">
                        <button class="self-attendance-btn" id="searchBtn">Search</button>
                    </div>
                    
                    <!-- Enter Roll Number -->
                    <div class="rollno-container">
                        <input type="text" class="rollno-input" id="rollNumber" placeholder="Enter your roll number...">
                        <button class="self-attendance-btn" id="rollnoBtn">Find</button>
                    </div>
                    
                    <!-- Student Found Display -->
                    <div class="student-found" id="studentFound">
                        <div class="student-found-info">
                            <div>
                                <strong id="foundStudentName"></strong>
                                <div id="foundStudentId"></div>
                                <div id="foundStudentStatus"></div>
                                <div id="foundStudentFeeStatus"></div>
                            </div>
                            <div>
                                <button class="mark-attendance-btn" id="markFoundAttendance">Check In</button>
                                <button class="mark-checkout-btn" id="markFoundCheckout">Check Out</button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Quick Attendance Buttons -->
                    <div class="quick-attendance-buttons" id="quickAttendanceButtons">
                        <!-- Quick buttons will be generated dynamically -->
                    </div>
                </div>
                
                <div class="panel-actions">
                    <button class="btn btn-reset" id="resetAttendance">Reset All Attendance</button>
                    <button class="btn btn-mark-attendance" id="saveAttendance">Save All Attendance</button>
                </div>
            </div>
        </div>
        
        <div class="report-container" id="reportContainer">
            <div class="report-title"><i class="fas fa-chart-bar"></i> Attendance Report</div>
            <table class="report-table">
                <thead>
                    <tr>
                        <th>Student ID</th>
                        <th>Name</th>
                        <th>Status</th>
                        <th>Check-in Time</th>
                        <th>Check-out Time</th>
                        <th>Fee Status</th>
                        <th>Fee Amount</th>
                    </tr>
                </thead>
                <tbody id="reportTableBody">
                    <!-- Report data will be populated here -->
                </tbody>
            </table>
        </div>
    </div>

    <!-- Add Student Modal -->
    <div class="modal" id="addStudentModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title"><i class="fas fa-user-plus"></i> Add New Student</div>
                <button class="close-modal">&times;</button>
            </div>
            <form id="addStudentForm">
                <div class="form-group">
                    <label class="form-label" for="studentName">Full Name</label>
                    <input type="text" class="form-input" id="studentName" required>
                </div>
                <div class="form-group">
                    <label class="form-label" for="studentRoll">Roll Number</label>
                    <input type="text" class="form-input" id="studentRoll" required>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label" for="studentEmail">Email Address</label>
                        <input type="email" class="form-input" id="studentEmail" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="studentMobile">Mobile Number</label>
                        <input type="tel" class="form-input" id="studentMobile" placeholder="+91 9876543210" required>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label" for="studentCourse">Select Course</label>
                    <select class="form-input" id="studentCourse" required>
                        <option value="o-level">'O' Level</option>
                        <option value="adca">ADCA</option>
                        <option value="ccc">CCC</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label" for="studentFee">Fee Amount (â‚¹)</label>
                    <input type="number" class="form-input" id="studentFee" placeholder="Enter fee amount" required>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-reset close-modal">Cancel</button>
                    <button type="submit" class="btn btn-add">Add Student</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Remove Student Modal -->
    <div class="modal" id="removeStudentModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title"><i class="fas fa-user-times"></i> Remove Student</div>
                <button class="close-modal">&times;</button>
            </div>
            <div class="form-group">
                <label class="form-label" for="removeStudentSelect">Select Student to Remove</label>
                <select class="form-input" id="removeStudentSelect">
                    <!-- Options will be populated dynamically -->
                </select>
            </div>
            <div class="form-actions">
                <button type="button" class="btn btn-reset close-modal">Cancel</button>
                <button type="button" class="btn btn-remove" id="confirmRemove">Remove Student</button>
            </div>
        </div>
    </div>

    <!-- Set Fee Due Date Modal -->
    <div class="modal" id="setFeeDateModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title"><i class="fas fa-calendar-alt"></i> Set Fee Due Date</div>
                <button class="close-modal">&times;</button>
            </div>
            <div class="form-group">
                <label class="form-label" for="feeDueDate">Fee Due Date</label>
                <input type="date" class="form-input" id="feeDueDate" required>
            </div>
            <div class="form-group">
                <label class="form-label" for="feeAmount">Default Fee Amount (â‚¹)</label>
                <input type="number" class="form-input" id="feeAmount" placeholder="Enter default fee amount" required>
            </div>
            <div class="form-actions">
                <button type="button" class="btn btn-reset close-modal">Cancel</button>
                <button type="button" class="btn btn-add" id="confirmFeeDate">Set Due Date</button>
            </div>
        </div>
    </div>

    <!-- Set Individual Fee Modal -->
    <div class="modal" id="setIndividualFeeModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title"><i class="fas fa-money-bill-wave"></i> Set Individual Student Fee</div>
                <button class="close-modal">&times;</button>
            </div>
            <div class="form-group">
                <label class="form-label" for="individualStudentSelect">Select Student</label>
                <select class="form-input" id="individualStudentSelect">
                    <!-- Options will be populated dynamically -->
                </select>
            </div>
            <div class="form-group">
                <label class="form-label" for="individualFeeAmount">Fee Amount (â‚¹)</label>
                <input type="number" class="form-input" id="individualFeeAmount" placeholder="Enter fee amount" required>
            </div>
            <div class="form-group">
                <label class="form-label" for="individualFeeDueDate">Fee Due Date</label>
                <input type="date" class="form-input" id="individualFeeDueDate" required>
            </div>
            <div class="form-actions">
                <button type="button" class="btn btn-reset close-modal">Cancel</button>
                <button type="button" class="btn btn-add" id="confirmIndividualFee">Set Fee</button>
            </div>
        </div>
    </div>

    <!-- Generate QR Code Modal -->
    <div class="modal" id="generateQRCodeModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title"><i class="fas fa-qrcode"></i> Generate Payment QR Code</div>
                <button class="close-modal">&times;</button>
            </div>
            <div class="form-group">
                <label class="form-label" for="qrStudentSelect">Select Student</label>
                <select class="form-input" id="qrStudentSelect">
                    <!-- Options will be populated dynamically -->
                </select>
            </div>
            <div class="form-group">
                <label class="form-label" for="qrAmount">Amount (â‚¹)</label>
                <input type="number" class="form-input" id="qrAmount" placeholder="Enter amount" required>
            </div>
            <div class="form-actions">
                <button type="button" class="btn btn-reset close-modal">Cancel</button>
                <button type="button" class="btn btn-add" id="generateQRBtn">Generate QR Code</button>
            </div>
            <div class="qr-code-container" id="qrCodeContainer" style="display: none;">
                <div class="qr-code" id="qrCode"></div>
                <div class="payment-details">
                    <h4>Payment Details</h4>
                    <div id="paymentInfo">
                        <!-- Payment details will be populated here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Sample student data with attendance records and mobile numbers
        let studentsData = {
            'o-level': [
                {
                    id: 'OL001',
                    name: 'Rajesh Kumar',
                    rollNo: 'R001',
                    email: 'rajesh@example.com',
                    mobile: '+91 9876543210',
                    status: 'absent',
                    checkInTime: '',
                    checkOutTime: '',
                    feeStatus: 'paid',
                    feeAmount: 5000,
                    feeDueDate: '2024-12-31',
                    lastFeePaidDate: '2024-01-15'
                },
                {
                    id: 'OL002',
                    name: 'Priya Sharma',
                    rollNo: 'R002',
                    email: 'priya@example.com',
                    mobile: '+91 9876543211',
                    status: 'absent',
                    checkInTime: '',
                    checkOutTime: '',
                    feeStatus: 'due',
                    feeAmount: 5000,
                    feeDueDate: '2024-12-31',
                    lastFeePaidDate: ''
                }
            ],
            'adca': [
                {
                    id: 'AD001',
                    name: 'Amit Singh',
                    rollNo: 'A001',
                    email: 'amit@example.com',
                    mobile: '+91 9876543212',
                    status: 'absent',
                    checkInTime: '',
                    checkOutTime: '',
                    feeStatus: 'paid',
                    feeAmount: 3000,
                    feeDueDate: '2024-12-31',
                    lastFeePaidDate: '2024-01-10'
                }
            ],
            'ccc': [
                {
                    id: 'CC001',
                    name: 'Sneha Patel',
                    rollNo: 'C001',
                    email: 'sneha@example.com',
                    mobile: '+91 9876543213',
                    status: 'absent',
                    checkInTime: '',
                    checkOutTime: '',
                    feeStatus: 'paid',
                    feeAmount: 2000,
                    feeDueDate: '2024-12-31',
                    lastFeePaidDate: '2024-01-05'
                }
            ]
        };

        // Teacher password
        const TEACHER_PASSWORD = "123";
        const TEACHER_EMAIL = "sv9956525898@gmail.com";
        let isTeacherLoggedIn = false;
        let currentFoundStudent = null;
        
        // Pending approvals
        let pendingApprovals = [];
        
        // Fee settings
        let feeDueDate = '';
        let defaultFeeAmount = 5000;
        
        // Fee reminder settings
        let reminderDaysBefore = 5;

        // Face Recognition Variables
        let faceRecognitionActive = false;
        let videoStream = null;
        let faceMatcher = null;
        let labeledFaceDescriptors = null;
        let faceDetectionInterval = null;
        let capturedFaces = {};

        // Set today's date as default
        document.getElementById('attendance-date').valueAsDate = new Date();

        // Initialize fee management
        function initializeFeeManagement() {
            // Set default fee due date to end of current month
            const today = new Date();
            const lastDay = new Date(today.getFullYear(), today.getMonth() + 1, 0);
            document.getElementById('feeDueDate').valueAsDate = lastDay;
            document.getElementById('individualFeeDueDate').valueAsDate = lastDay;
            
            // Set default fee amount
            document.getElementById('feeAmount').value = defaultFeeAmount;
            
            // Initialize fee status for all students
            updateAllStudentsFeeStatus();
        }

        function updateAllStudentsFeeStatus() {
            const currentDate = new Date();
            
            Object.keys(studentsData).forEach(classId => {
                studentsData[classId].forEach(student => {
                    if (student.feeDueDate) {
                        const dueDate = new Date(student.feeDueDate);
                        if (currentDate > dueDate && student.feeStatus !== 'paid') {
                            student.feeStatus = 'due';
                        }
                    }
                });
            });
            
            updateFeeDueCount();
        }

        // Real-time clock function
        function updateRealTimeClock() {
            const now = new Date();
            const dateString = now.toLocaleDateString('en-IN', { 
                weekday: 'short', 
                year: 'numeric', 
                month: 'short', 
                day: 'numeric' 
            });
            const timeString = now.toLocaleTimeString('en-IN', { 
                hour: '2-digit', 
                minute: '2-digit', 
                second: '2-digit',
                hour12: true 
            });
            document.getElementById('realTimeClock').textContent = `${dateString} | ${timeString}`;
        }

        // Update clock immediately and then every second
        updateRealTimeClock();
        setInterval(updateRealTimeClock, 1000);

        // Function to generate student cards
        function generateStudentCards(classId) {
            const studentList = document.getElementById('student-list');
            studentList.innerHTML = '';
            
            const students = studentsData[classId] || [];
            
            if (students.length === 0) {
                studentList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-book-open"></i>
                        <h3>No students in this course</h3>
                        <p>Add students to start tracking attendance</p>
                    </div>
                `;
                return;
            }
            
            students.forEach(student => {
                const studentCard = document.createElement('div');
                
                // Add fee-due class if fee is due
                let cardClass = `student-card ${student.status}`;
                if (student.feeStatus === 'due') {
                    cardClass += ' fee-due';
                }
                studentCard.className = cardClass;
                
                const initials = student.name.split(' ').map(n => n[0]).join('');
                
                let statusText = '';
                let timeText = '';
                
                if (student.status === 'pending') {
                    statusText = 'PENDING';
                    timeText = `Waiting for teacher approval`;
                } else if (student.status === 'present') {
                    statusText = 'PRESENT';
                    timeText = `Checked in at: ${student.checkInTime}`;
                } else if (student.status === 'checked-out') {
                    statusText = 'CHECKED OUT';
                    timeText = `Checked out at: ${student.checkOutTime}`;
                } else {
                    statusText = 'ABSENT';
                    timeText = 'Not checked in yet';
                }
                
                // FIXED: Proper checkbox states based on student status
                const isPresentChecked = student.status === 'present' || student.status === 'checked-out';
                const isAbsentChecked = student.status === 'checked-out';
                
                studentCard.innerHTML = `
                    <div class="student-info">
                        <div class="student-avatar">${initials}</div>
                        <div class="student-details">
                            <div class="student-name">${student.name}</div>
                            <div class="student-id">ID: ${student.id} | Roll: ${student.rollNo}</div>
                            <div class="contact-info">
                                <i class="fas fa-envelope"></i> ${student.email} | 
                                <i class="fas fa-phone"></i> ${student.mobile}
                            </div>
                            <div class="attendance-time">${timeText}</div>
                            <div class="fee-status ${student.feeStatus}">
                                ${student.feeStatus === 'paid' ? 
                                    '<i class="fas fa-check-circle"></i> Fee Paid (â‚¹' + student.feeAmount + ')' : 
                                    '<i class="fas fa-exclamation-triangle"></i> Fee Due (â‚¹' + student.feeAmount + ')'}
                                ${student.feeDueDate ? ' | Due: ' + new Date(student.feeDueDate).toLocaleDateString() : ''}
                            </div>
                        </div>
                    </div>
                    <div class="attendance-toggle">
                        <span class="toggle-label">${statusText}</span>
                        <div class="attendance-options">
                            <div class="attendance-option">
                                <input type="checkbox" class="attendance-checkbox present-checkbox" data-id="${student.id}" data-status="present" ${isPresentChecked ? 'checked' : ''}>
                                <label for="present-${student.id}">Check In</label>
                            </div>
                            <div class="attendance-option">
                                <input type="checkbox" class="attendance-checkbox absent-checkbox" data-id="${student.id}" data-status="absent" ${isAbsentChecked ? 'checked' : ''}>
                                <label for="absent-${student.id}">Check Out</label>
                            </div>
                        </div>
                    </div>
                `;
                
                studentList.appendChild(studentCard);
            });
            
            // FIXED: Add proper event listeners to checkboxes
            document.querySelectorAll('.present-checkbox').forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    const studentId = this.getAttribute('data-id');
                    if (this.checked) {
                        // Uncheck absent checkbox
                        const absentCheckbox = document.querySelector(`.absent-checkbox[data-id="${studentId}"]`);
                        if (absentCheckbox) absentCheckbox.checked = false;
                        markCheckIn(studentId);
                    } else {
                        // If unchecking present, mark as absent
                        const activeClass = document.querySelector('.class-item.active').getAttribute('data-class');
                        const student = studentsData[activeClass].find(s => s.id === studentId);
                        if (student && student.status === 'present') {
                            student.status = 'absent';
                            student.checkInTime = '';
                            updateAttendanceStats(activeClass);
                            generateStudentCards(activeClass);
                        }
                    }
                });
            });
            
            document.querySelectorAll('.absent-checkbox').forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    const studentId = this.getAttribute('data-id');
                    if (this.checked) {
                        // Uncheck present checkbox
                        const presentCheckbox = document.querySelector(`.present-checkbox[data-id="${studentId}"]`);
                        if (presentCheckbox) presentCheckbox.checked = false;
                        markCheckOut(studentId);
                    } else {
                        // If unchecking checkout, mark as present
                        const activeClass = document.querySelector('.class-item.active').getAttribute('data-class');
                        const student = studentsData[activeClass].find(s => s.id === studentId);
                        if (student && student.status === 'checked-out') {
                            student.status = 'present';
                            student.checkOutTime = '';
                            updateAttendanceStats(activeClass);
                            generateStudentCards(activeClass);
                        }
                    }
                });
            });
            
            updateAttendanceStats(classId);
            updateStudentCounts();
            generateQuickAttendanceButtons(classId);
            updateFeeDueCount();
            updateFeeSummary();
        }

        // FIXED: Function to mark check-in
        function markCheckIn(studentId) {
            const activeClass = document.querySelector('.class-item.active').getAttribute('data-class');
            const student = studentsData[activeClass].find(s => s.id === studentId);
            
            if (student) {
                if (student.status === 'checked-out') {
                    alert(`${student.name} has already checked out for the day at ${student.checkOutTime}`);
                    // Keep the checkbox in correct state
                    generateStudentCards(activeClass);
                    return;
                }
                
                // Check if fee is due and show notification
                if (student.feeStatus === 'due') {
                    showFeeNotification(`${student.name}, your fee of â‚¹${student.feeAmount} is due! Please pay your fees.`);
                }
                
                // Record check-in time
                const now = new Date();
                const dateString = now.toLocaleDateString('en-IN');
                const timeString = now.toLocaleTimeString('en-IN', { 
                    hour: '2-digit', 
                    minute: '2-digit',
                    hour12: true 
                });
                
                // If teacher is logged in, mark directly as present
                if (isTeacherLoggedIn) {
                    // Set status to present
                    student.status = 'present';
                    student.checkInTime = `${dateString} ${timeString}`;
                    
                    // Show notification
                    showNotification(`${student.name} checked in at ${student.checkInTime}`, 'checkin');
                } else {
                    // Set status to pending and add to approval queue
                    student.status = 'pending';
                    student.checkInTime = `${dateString} ${timeString}`;
                    
                    // Add to pending approvals
                    pendingApprovals.push({
                        studentId: studentId,
                        studentName: student.name,
                        class: activeClass,
                        action: 'checkin',
                        time: student.checkInTime
                    });
                    
                    // Show notification
                    showNotification(`${student.name} check-in request submitted. Waiting for teacher approval.`, 'checkin');
                    
                    // Send email to teacher (simulated)
                    sendTeacherEmail(student, 'checkin');
                }
                
                updateAttendanceStats(activeClass);
                generateStudentCards(activeClass); // Refresh to update styling
                generateQuickAttendanceButtons(activeClass); // Update quick buttons
                updatePendingApprovals(); // Update pending approvals list
            }
        }

        // FIXED: Function to mark check-out
        function markCheckOut(studentId) {
            const activeClass = document.querySelector('.class-item.active').getAttribute('data-class');
            const student = studentsData[activeClass].find(s => s.id === studentId);
            
            if (student) {
                if (student.status === 'absent') {
                    alert(`${student.name} hasn't checked in yet!`);
                    // Keep the checkbox in correct state
                    generateStudentCards(activeClass);
                    return;
                }
                
                // Record check-out time
                const now = new Date();
                const dateString = now.toLocaleDateString('en-IN');
                const timeString = now.toLocaleTimeString('en-IN', { 
                    hour: '2-digit', 
                    minute: '2-digit',
                    hour12: true 
                });
                
                // If teacher is logged in, mark directly as checked-out
                if (isTeacherLoggedIn) {
                    // Set status to checked-out
                    student.status = 'checked-out';
                    student.checkOutTime = `${dateString} ${timeString}`;
                    
                    // Show notification
                    showNotification(`${student.name} checked out at ${student.checkOutTime}`, 'checkout');
                } else {
                    // Set status to pending and add to approval queue
                    student.status = 'pending';
                    student.checkOutTime = `${dateString} ${timeString}`;
                    
                    // Add to pending approvals
                    pendingApprovals.push({
                        studentId: studentId,
                        studentName: student.name,
                        class: activeClass,
                        action: 'checkout',
                        time: student.checkOutTime
                    });
                    
                    // Show notification
                    showNotification(`${student.name} check-out request submitted. Waiting for teacher approval.`, 'checkout');
                    
                    // Send email to teacher (simulated)
                    sendTeacherEmail(student, 'checkout');
                }
                
                updateAttendanceStats(activeClass);
                generateStudentCards(activeClass); // Refresh to update styling
                generateQuickAttendanceButtons(activeClass); // Update quick buttons
                updatePendingApprovals(); // Update pending approvals list
            }
        }

        // Function to send email to teacher (simulated)
        function sendTeacherEmail(student, action) {
            // In a real implementation, this would send an actual email
            // For this demo, we'll just show a notification
            const notification = document.getElementById('emailNotification');
            notification.innerHTML = `<i class="fas fa-envelope"></i> Email sent to ${TEACHER_EMAIL}: ${student.name} requested ${action === 'checkin' ? 'check-in' : 'check-out'} approval`;
            notification.style.display = 'block';
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, 5000);
            
            console.log(`Email sent to ${TEACHER_EMAIL}: ${student.name} requested ${action} approval`);
        }

        // Function to show notification
        function showNotification(message, type) {
            const notification = document.getElementById(type === 'checkin' ? 'attendanceNotification' : 'checkoutNotification');
            notification.textContent = message;
            notification.style.display = 'block';
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, 3000);
        }

        // Function to show fee notification
        function showFeeNotification(message) {
            const notification = document.getElementById('feeNotification');
            notification.innerHTML = `<i class="fas fa-money-bill-wave"></i> ${message}`;
            notification.style.display = 'block';
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, 5000);
        }

        // Function to update attendance statistics
        function updateAttendanceStats(classId) {
            const students = studentsData[classId] || [];
            const presentCount = students.filter(s => s.status === 'present').length;
            const absentCount = students.filter(s => s.status === 'absent').length;
            const checkedOutCount = students.filter(s => s.status === 'checked-out').length;
            const pendingCount = students.filter(s => s.status === 'pending').length;
            
            document.getElementById('presentCount').textContent = presentCount;
            document.getElementById('absentCount').textContent = absentCount + pendingCount;
            document.getElementById('checkedOutCount').textContent = checkedOutCount;
        }

        // Function to update student counts in sidebar
        function updateStudentCounts() {
            document.querySelectorAll('.class-item').forEach(item => {
                const classId = item.getAttribute('data-class');
                const count = studentsData[classId] ? studentsData[classId].length : 0;
                item.querySelector('.student-count').textContent = count;
            });
        }

        // Function to update fee due count
        function updateFeeDueCount() {
            let totalDue = 0;
            Object.keys(studentsData).forEach(classId => {
                totalDue += studentsData[classId].filter(s => s.feeStatus === 'due').length;
            });
            document.getElementById('feeDueCount').textContent = totalDue;
        }

        // Function to update pending approvals
        function updatePendingApprovals() {
            const approvalList = document.getElementById('approvalList');
            const pendingCount = document.getElementById('pendingCount');
            const teacherApprovalSection = document.getElementById('teacherApprovalSection');
            
            // Update pending count
            pendingCount.textContent = pendingApprovals.length;
            
            // Show/hide approval section
            if (pendingApprovals.length > 0 && isTeacherLoggedIn) {
                teacherApprovalSection.style.display = 'block';
            } else {
                teacherApprovalSection.style.display = 'none';
            }
            
            // Clear approval list
            approvalList.innerHTML = '';
            
            // Add pending approvals
            pendingApprovals.forEach((approval, index) => {
                const approvalItem = document.createElement('div');
                approvalItem.className = 'approval-item';
                approvalItem.innerHTML = `
                    <div>
                        <strong>${approval.studentName}</strong>
                        <div>${approval.action === 'checkin' ? 'Check-in' : 'Check-out'} at ${approval.time}</div>
                    </div>
                    <div class="approval-actions">
                        <button class="approve-btn" data-index="${index}"><i class="fas fa-check"></i> Approve</button>
                        <button class="reject-btn" data-index="${index}"><i class="fas fa-times"></i> Reject</button>
                    </div>
                `;
                approvalList.appendChild(approvalItem);
            });
            
            // Add event listeners to approval buttons
            document.querySelectorAll('.approve-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const index = this.getAttribute('data-index');
                    approveAttendance(index);
                });
            });
            
            document.querySelectorAll('.reject-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const index = this.getAttribute('data-index');
                    rejectAttendance(index);
                });
            });
        }

        // Function to approve attendance
        function approveAttendance(index) {
            const approval = pendingApprovals[index];
            const student = studentsData[approval.class].find(s => s.id === approval.studentId);
            
            if (student) {
                if (approval.action === 'checkin') {
                    student.status = 'present';
                } else if (approval.action === 'checkout') {
                    student.status = 'checked-out';
                }
                
                // Remove from pending approvals
                pendingApprovals.splice(index, 1);
                
                // Update UI
                updatePendingApprovals();
                generateStudentCards(approval.class);
                updateAttendanceStats(approval.class);
                
                alert(`Attendance for ${student.name} has been approved.`);
            }
        }

        // Function to reject attendance
        function rejectAttendance(index) {
            const approval = pendingApprovals[index];
            const student = studentsData[approval.class].find(s => s.id === approval.studentId);
            
            if (student) {
                // Reset student status based on the action
                if (approval.action === 'checkin') {
                    student.status = 'absent';
                    student.checkInTime = '';
                } else if (approval.action === 'checkout') {
                    // If rejecting a checkout, set status back to present
                    student.status = 'present';
                    student.checkOutTime = '';
                }
                
                // Remove from pending approvals
                pendingApprovals.splice(index, 1);
                
                // Update UI
                updatePendingApprovals();
                generateStudentCards(approval.class);
                updateAttendanceStats(approval.class);
                
                alert(`Attendance for ${student.name} has been rejected.`);
            }
        }

        // Function to update fee management section
        function updateFeeManagement() {
            const feeList = document.getElementById('feeList');
            const feeManagementSection = document.getElementById('feeManagementSection');
            
            // Show/hide fee management section
            if (isTeacherLoggedIn) {
                feeManagementSection.style.display = 'block';
            } else {
                feeManagementSection.style.display = 'none';
                return;
            }
            
            // Clear fee list
            feeList.innerHTML = '';
            
            // Get active class
            const activeClass = document.querySelector('.class-item.active').getAttribute('data-class');
            const students = studentsData[activeClass];
            
            if (students.length === 0) {
                feeList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-users"></i>
                        <h3>No students in this course</h3>
                        <p>Add students to manage fees</p>
                    </div>
                `;
                return;
            }
            
            // Add students with fee status
            students.forEach(student => {
                const feeItem = document.createElement('div');
                feeItem.className = 'fee-item';
                
                const dueDateInfo = student.feeDueDate ? 
                    `Due: ${new Date(student.feeDueDate).toLocaleDateString()}` : 
                    'Due date not set';
                    
                feeItem.innerHTML = `
                    <div>
                        <strong>${student.name}</strong>
                        <div>ID: ${student.id} | Roll: ${student.rollNo}</div>
                        <div class="contact-info">
                            <i class="fas fa-envelope"></i> ${student.email} | 
                            <i class="fas fa-phone"></i> ${student.mobile}
                        </div>
                        <div class="fee-status ${student.feeStatus}">
                            ${student.feeStatus === 'paid' ? 
                                '<i class="fas fa-check-circle"></i> Fee Paid (â‚¹' + student.feeAmount + ')' : 
                                '<i class="fas fa-exclamation-triangle"></i> Fee Due (â‚¹' + student.feeAmount + ')'}
                            ${student.feeStatus === 'paid' && student.lastFeePaidDate ? 
                                ` (Paid on: ${student.lastFeePaidDate})` : 
                                ` (${dueDateInfo})`}
                        </div>
                    </div>
                    <div class="fee-actions">
                        <button class="set-fee-btn" data-id="${student.id}"><i class="fas fa-edit"></i> Set Fee</button>
                        ${student.feeStatus === 'due' ? 
                            `<button class="mark-paid-btn" data-id="${student.id}"><i class="fas fa-check"></i> Mark Paid</button>` : 
                            ''}
                        <button class="send-reminder-btn" data-id="${student.id}"><i class="fas fa-envelope"></i> Send Reminder</button>
                    </div>
                `;
                feeList.appendChild(feeItem);
            });
            
            // Add event listeners to fee buttons
            document.querySelectorAll('.set-fee-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const studentId = this.getAttribute('data-id');
                    openSetIndividualFeeModal(studentId);
                });
            });
            
            document.querySelectorAll('.mark-paid-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const studentId = this.getAttribute('data-id');
                    markFeeAsPaid(studentId);
                });
            });
            
            document.querySelectorAll('.send-reminder-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const studentId = this.getAttribute('data-id');
                    sendFeeReminder(studentId);
                });
            });
            
            updateFeeSummary();
        }

        // Function to open set individual fee modal
        function openSetIndividualFeeModal(studentId) {
            const activeClass = document.querySelector('.class-item.active').getAttribute('data-class');
            const student = studentsData[activeClass].find(s => s.id === studentId);
            
            if (student) {
                // Populate the student dropdown
                const select = document.getElementById('individualStudentSelect');
                select.innerHTML = '';
                
                studentsData[activeClass].forEach(s => {
                    const option = document.createElement('option');
                    option.value = s.id;
                    option.textContent = `${s.name} (${s.id}) - Current: â‚¹${s.feeAmount}`;
                    if (s.id === studentId) {
                        option.selected = true;
                    }
                    select.appendChild(option);
                });
                
                // Set current values
                document.getElementById('individualFeeAmount').value = student.feeAmount;
                if (student.feeDueDate) {
                    document.getElementById('individualFeeDueDate').value = student.feeDueDate;
                }
                
                document.getElementById('setIndividualFeeModal').style.display = 'flex';
            }
        }

        // Function to set individual fee
        function setIndividualFee() {
            const studentId = document.getElementById('individualStudentSelect').value;
            const feeAmount = parseFloat(document.getElementById('individualFeeAmount').value);
            const dueDate = document.getElementById('individualFeeDueDate').value;
            
            if (!feeAmount || !dueDate) {
                alert('Please enter both fee amount and due date');
                return;
            }
            
            const activeClass = document.querySelector('.class-item.active').getAttribute('data-class');
            const student = studentsData[activeClass].find(s => s.id === studentId);
            
            if (student) {
                student.feeAmount = feeAmount;
                student.feeDueDate = dueDate;
                
                // Check if current date is past the fee due date
                const currentDate = new Date();
                const dueDateObj = new Date(dueDate);
                
                if (currentDate > dueDateObj && student.feeStatus !== 'paid') {
                    student.feeStatus = 'due';
                }
                
                // Update UI
                generateStudentCards(activeClass);
                updateFeeManagement();
                updateFeeDueCount();
                
                // Close modal
                document.getElementById('setIndividualFeeModal').style.display = 'none';
                
                // Show success notification
                showFeeNotification(`Fee for ${student.name} set to â‚¹${feeAmount} with due date ${new Date(dueDate).toLocaleDateString()}`);
            }
        }

        // Function to mark fee as paid
        function markFeeAsPaid(studentId) {
            const activeClass = document.querySelector('.class-item.active').getAttribute('data-class');
            const student = studentsData[activeClass].find(s => s.id === studentId);
            
            if (student) {
                student.feeStatus = 'paid';
                student.lastFeePaidDate = new Date().toISOString().split('T')[0];
                
                // Update UI
                generateStudentCards(activeClass);
                updateFeeManagement();
                updateFeeDueCount();
                
                // Show success notification
                showNotification(`Fee for ${student.name} has been marked as paid.`, 'checkin');
            }
        }

        // Function to send fee reminder
        function sendFeeReminder(studentId) {
            const activeClass = document.querySelector('.class-item.active').getAttribute('data-class');
            const student = studentsData[activeClass].find(s => s.id === studentId);
            
            if (student) {
                // Check if reminder should be sent (5 days before due date)
                const currentDate = new Date();
                const dueDate = new Date(student.feeDueDate);
                const daysUntilDue = Math.ceil((dueDate - currentDate) / (1000 * 60 * 60 * 24));
                
                if (daysUntilDue <= reminderDaysBefore && student.feeStatus !== 'paid') {
                    // Send reminder
                    const message = `Dear ${student.name}, your fee of â‚¹${student.feeAmount} is due on ${dueDate.toLocaleDateString()}. Please pay before the due date to avoid late fees.`;
                    
                    // Simulate sending SMS
                    console.log(`SMS to ${student.mobile}: ${message}`);
                    
                    // Simulate sending email
                    console.log(`Email to ${student.email}: ${message}`);
                    
                    showNotification(`Fee reminder sent to ${student.name} via SMS and email.`, 'checkin');
                } else if (student.feeStatus === 'paid') {
                    showNotification(`${student.name} has already paid the fee.`, 'checkin');
                } else {
                    showNotification(`Reminder for ${student.name} will be sent ${reminderDaysBefore} days before due date.`, 'checkin');
                }
            }
        }

        // Function to set fee due date for all students
        function setFeeDueDateForAll() {
            const dueDate = document.getElementById('feeDueDate').value;
            const amount = parseFloat(document.getElementById('feeAmount').value);
            
            if (!dueDate || !amount) {
                alert('Please enter both due date and fee amount');
                return;
            }
            
            feeDueDate = dueDate;
            defaultFeeAmount = amount;
            
            // Update all students' fee status and due date
            Object.keys(studentsData).forEach(classId => {
                studentsData[classId].forEach(student => {
                    student.feeDueDate = dueDate;
                    student.feeAmount = amount;
                    
                    // Check if current date is past the fee due date
                    const currentDate = new Date();
                    const dueDateObj = new Date(dueDate);
                    
                    if (currentDate > dueDateObj && student.feeStatus !== 'paid') {
                        student.feeStatus = 'due';
                    } else {
                        // Only set to paid if it wasn't already due
                        if (student.feeStatus !== 'due') {
                            student.feeStatus = 'paid';
                        }
                    }
                });
            });
            
            // Update UI
            const activeClass = document.querySelector('.class-item.active').getAttribute('data-class');
            generateStudentCards(activeClass);
            updateFeeManagement();
            updateFeeDueCount();
            
            // Close modal
            document.getElementById('setFeeDateModal').style.display = 'none';
            
            // Show success notification
            showFeeNotification(`Fee due date set to ${new Date(dueDate).toLocaleDateString()} with amount â‚¹${amount} for all students.`);
        }

        // Function to send fee reminders to all students with due fees
        function sendFeeRemindersToAll() {
            if (!feeDueDate) {
                alert('Please set fee due date first');
                return;
            }
            
            let reminderCount = 0;
            const dueStudents = [];
            
            Object.keys(studentsData).forEach(classId => {
                studentsData[classId].forEach(student => {
                    if (student.feeStatus === 'due') {
                        reminderCount++;
                        dueStudents.push(student.name);
                        
                        // Send reminder
                        const message = `Dear ${student.name}, your fee of â‚¹${student.feeAmount} is overdue. Please pay immediately to avoid any inconvenience.`;
                        
                        // Simulate sending SMS
                        console.log(`SMS to ${student.mobile}: ${message}`);
                        
                        // Simulate sending email
                        console.log(`Email to ${student.email}: ${message}`);
                    } else if (student.feeDueDate) {
                        // Check if reminder should be sent (5 days before due date)
                        const currentDate = new Date();
                        const dueDate = new Date(student.feeDueDate);
                        const daysUntilDue = Math.ceil((dueDate - currentDate) / (1000 * 60 * 60 * 24));
                        
                        if (daysUntilDue <= reminderDaysBefore && student.feeStatus !== 'paid') {
                            reminderCount++;
                            dueStudents.push(student.name);
                            
                            // Send reminder
                            const message = `Dear ${student.name}, your fee of â‚¹${student.feeAmount} is due on ${dueDate.toLocaleDateString()}. Please pay before the due date to avoid late fees.`;
                            
                            // Simulate sending SMS
                            console.log(`SMS to ${student.mobile}: ${message}`);
                            
                            // Simulate sending email
                            console.log(`Email to ${student.email}: ${message}`);
                        }
                    }
                });
            });
            
            if (reminderCount > 0) {
                showFeeNotification(`Fee reminders sent to ${reminderCount} students: ${dueStudents.join(', ')}`);
            } else {
                showFeeNotification('No students have due fees or approaching due dates at the moment.');
            }
        }

        // Function to update fee summary
        function updateFeeSummary() {
            const activeClass = document.querySelector('.class-item.active').getAttribute('data-class');
            const students = studentsData[activeClass];
            
            const totalStudents = students.length;
            const paidStudents = students.filter(s => s.feeStatus === 'paid').length;
            const dueStudents = students.filter(s => s.feeStatus === 'due').length;
            const totalRevenue = students.reduce((sum, student) => {
                return student.feeStatus === 'paid' ? sum + student.feeAmount : sum;
            }, 0);
            
            if (document.getElementById('totalStudents')) {
                document.getElementById('totalStudents').textContent = totalStudents;
                document.getElementById('paidStudents').textContent = paidStudents;
                document.getElementById('dueStudents').textContent = dueStudents;
                document.getElementById('totalRevenue').textContent = `â‚¹${totalRevenue}`;
            }
        }

        // Function to generate quick attendance buttons
        function generateQuickAttendanceButtons(classId) {
            const quickButtons = document.getElementById('quickAttendanceButtons');
            quickButtons.innerHTML = '';
            
            const students = studentsData[classId] || [];
            
            students.forEach(student => {
                const button = document.createElement('button');
                button.className = student.status === 'present' || student.status === 'checked-out' ? 'checkout-btn' : 'quick-btn';
                button.textContent = `${student.name} - ${student.status === 'present' ? 'Check Out' : 'Check In'}`;
                button.addEventListener('click', function() {
                    if (student.status === 'present' || student.status === 'checked-out') {
                        markCheckOut(student.id);
                    } else {
                        markCheckIn(student.id);
                    }
                });
                quickButtons.appendChild(button);
            });
        }

        // Search student by name
        document.getElementById('searchBtn').addEventListener('click', function() {
            const searchTerm = document.getElementById('searchName').value.toLowerCase().trim();
            if (!searchTerm) {
                alert('Please enter a name to search');
                return;
            }
            
            const activeClass = document.querySelector('.class-item.active').getAttribute('data-class');
            const student = studentsData[activeClass].find(s => 
                s.name.toLowerCase().includes(searchTerm)
            );
            
            if (student) {
                showFoundStudent(student);
            } else {
                alert('No student found with that name');
            }
        });

        // Find student by roll number
        document.getElementById('rollnoBtn').addEventListener('click', function() {
            const rollNo = document.getElementById('rollNumber').value.trim();
            if (!rollNo) {
                alert('Please enter a roll number');
                return;
            }
            
            const activeClass = document.querySelector('.class-item.active').getAttribute('data-class');
            const student = studentsData[activeClass].find(s => s.rollNo === rollNo);
            
            if (student) {
                showFoundStudent(student);
            } else {
                alert('No student found with that roll number');
            }
        });

        // Show found student
        function showFoundStudent(student) {
            currentFoundStudent = student;
            document.getElementById('foundStudentName').textContent = student.name;
            document.getElementById('foundStudentId').textContent = `ID: ${student.id} | Roll: ${student.rollNo}`;
            
            let statusText = '';
            if (student.status === 'pending') {
                statusText = `Status: Pending Approval`;
            } else if (student.status === 'present') {
                statusText = `Status: Present (Checked in at ${student.checkInTime})`;
            } else if (student.status === 'checked-out') {
                statusText = `Status: Checked Out (Checked out at ${student.checkOutTime})`;
            } else {
                statusText = 'Status: Absent';
            }
            
            let feeStatusText = `Fee Status: ${student.feeStatus === 'paid' ? 'Paid' : 'Due'} (â‚¹${student.feeAmount})`;
            if (student.feeStatus === 'paid' && student.lastFeePaidDate) {
                feeStatusText += ` (Last paid: ${student.lastFeePaidDate})`;
            }
            
            let contactText = `Email: ${student.email} | Mobile: ${student.mobile}`;
            
            document.getElementById('foundStudentStatus').textContent = statusText;
            document.getElementById('foundStudentFeeStatus').textContent = feeStatusText;
            document.getElementById('foundStudentId').innerHTML += `<br><small style="font-size: 12px;">${contactText}</small>`;
            document.getElementById('studentFound').style.display = 'block';
            
            // Clear search inputs
            document.getElementById('searchName').value = '';
            document.getElementById('rollNumber').value = '';
        }

        // Mark check-in for found student
        document.getElementById('markFoundAttendance').addEventListener('click', function() {
            if (currentFoundStudent) {
                if (currentFoundStudent.status === 'checked-out') {
                    alert(`${currentFoundStudent.name} has already checked out for the day at ${currentFoundStudent.checkOutTime}`);
                    return;
                }
                
                markCheckIn(currentFoundStudent.id);
                document.getElementById('studentFound').style.display = 'none';
                currentFoundStudent = null;
            }
        });

        // Mark check-out for found student
        document.getElementById('markFoundCheckout').addEventListener('click', function() {
            if (currentFoundStudent) {
                if (currentFoundStudent.status === 'absent') {
                    alert(`${currentFoundStudent.name} hasn't checked in yet!`);
                    return;
                }
                
                markCheckOut(currentFoundStudent.id);
                document.getElementById('studentFound').style.display = 'none';
                currentFoundStudent = null;
            }
        });

        // Teacher login functionality
        document.getElementById('loginBtn').addEventListener('click', function() {
            const passwordInput = document.getElementById('teacherPassword');
            
            if (isTeacherLoggedIn) {
                // Logout
                isTeacherLoggedIn = false;
                document.getElementById('teacherControls').style.display = 'none';
                document.getElementById('teacherApprovalSection').style.display = 'none';
                document.getElementById('feeManagementSection').style.display = 'none';
                document.getElementById('dataManagementSection').style.display = 'none';
                document.getElementById('faceRecognitionSection').style.display = 'none';
                document.getElementById('teacherPanelControls').style.display = 'none';
                document.getElementById('reportContainer').style.display = 'none';
                passwordInput.value = '';
                passwordInput.placeholder = 'Teacher Password';
                this.textContent = 'Login';
                this.style.background = 'var(--warning)';
                
                // Stop face recognition if active
                if (faceRecognitionActive) {
                    stopFaceRecognition();
                }
                
                alert('Teacher panel locked!');
            } else {
                // Login attempt
                if (passwordInput.value === TEACHER_PASSWORD) {
                    isTeacherLoggedIn = true;
                    document.getElementById('teacherControls').style.display = 'block';
                    document.getElementById('teacherPanelControls').style.display = 'flex';
                    passwordInput.value = '';
                    passwordInput.placeholder = 'Logged In';
                    this.textContent = 'Logout';
                    this.style.background = 'var(--accent)';
                    
                    // Show pending approvals if any
                    updatePendingApprovals();
                    updateFeeManagement();
                    
                    // Initialize face recognition
                    initializeFaceRecognition();
                    
                    alert('Teacher panel unlocked!');
                } else {
                    alert('Incorrect password!');
                    passwordInput.value = '';
                }
            }
        });

        // Teacher panel controls
        document.getElementById('toggleTeacherPanel').addEventListener('click', function() {
            const teacherControls = document.getElementById('teacherControls');
            if (teacherControls.style.display === 'block') {
                teacherControls.style.display = 'none';
            } else {
                teacherControls.style.display = 'block';
            }
        });

        document.getElementById('toggleApprovals').addEventListener('click', function() {
            const approvalSection = document.getElementById('teacherApprovalSection');
            if (approvalSection.style.display === 'block') {
                approvalSection.style.display = 'none';
            } else {
                approvalSection.style.display = 'block';
                updatePendingApprovals();
            }
        });

        document.getElementById('toggleFeeManagement').addEventListener('click', function() {
            const feeSection = document.getElementById('feeManagementSection');
            if (feeSection.style.display === 'block') {
                feeSection.style.display = 'none';
            } else {
                feeSection.style.display = 'block';
                updateFeeManagement();
            }
        });

        document.getElementById('toggleReports').addEventListener('click', function() {
            const reportContainer = document.getElementById('reportContainer');
            if (reportContainer.style.display === 'block') {
                reportContainer.style.display = 'none';
            } else {
                reportContainer.style.display = 'block';
                
                // Populate report table
                const reportTableBody = document.getElementById('reportTableBody');
                reportTableBody.innerHTML = '';
                
                // Get active class
                const activeClass = document.querySelector('.class-item.active').getAttribute('data-class');
                const students = studentsData[activeClass];
                
                // Populate report table
                students.forEach(student => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${student.id}</td>
                        <td>${student.name}</td>
                        <td>${student.status === 'present' ? '<span style="color:green"><i class="fas fa-check-circle"></i> Present</span>' : 
                              student.status === 'checked-out' ? '<span style="color:blue"><i class="fas fa-sign-out-alt"></i> Checked Out</span>' : 
                              student.status === 'pending' ? '<span style="color:orange"><i class="fas fa-clock"></i> Pending</span>' : 
                              '<span style="color:red"><i class="fas fa-times-circle"></i> Absent</span>'}</td>
                        <td>${student.checkInTime || 'Not checked in'}</td>
                        <td>${student.checkOutTime || 'Not checked out'}</td>
                        <td>${student.feeStatus === 'paid' ? '<span style="color:green"><i class="fas fa-check-circle"></i> Paid</span>' : '<span style="color:red"><i class="fas fa-exclamation-triangle"></i> Due</span>'}</td>
                        <td>â‚¹${student.feeAmount}</td>
                    `;
                    reportTableBody.appendChild(row);
                });
            }
        });

        // Add event listeners to class items
        document.querySelectorAll('.class-item').forEach(item => {
            item.addEventListener('click', function() {
                // Remove active class from all items
                document.querySelectorAll('.class-item').forEach(i => {
                    i.classList.remove('active');
                });
                
                // Add active class to clicked item
                this.classList.add('active');
                
                // Update class title
                const className = this.querySelector('span').textContent;
                document.querySelector('.class-title').textContent = `${className} Course - Student Self-Attendance`;
                
                // Generate student cards for selected class
                const classId = this.getAttribute('data-class');
                generateStudentCards(classId);
                
                // Update fee management section
                updateFeeManagement();
            });
        });

        // Save All Attendance button functionality
        document.getElementById('saveAttendance').addEventListener('click', function() {
            const activeClass = document.querySelector('.class-item.active').getAttribute('data-class');
            const date = document.getElementById('attendance-date').value;
            
            // In a real application, you would send this data to a server
            alert(`Attendance for ${activeClass} on ${date} has been saved successfully!`);
            
            // Show confirmation animation
            const btn = this;
            const originalText = btn.textContent;
            btn.textContent = 'Attendance Saved!';
            btn.style.background = 'var(--success)';
            
            setTimeout(() => {
                btn.textContent = originalText;
                btn.style.background = 'var(--success)';
            }, 2000);
        });

        // Reset All Attendance button functionality
        document.getElementById('resetAttendance').addEventListener('click', function() {
            const activeClass = document.querySelector('.class-item.active').getAttribute('data-class');
            
            if (confirm('Are you sure you want to reset all attendance for this class?')) {
                studentsData[activeClass].forEach(student => {
                    student.status = 'absent';
                    student.checkInTime = '';
                    student.checkOutTime = '';
                });
                
                // Clear pending approvals for this class
                pendingApprovals = pendingApprovals.filter(approval => approval.class !== activeClass);
                updatePendingApprovals();
                
                generateStudentCards(activeClass);
                alert('All attendance has been reset!');
            }
        });

        // Modal functionality
        const addStudentModal = document.getElementById('addStudentModal');
        const removeStudentModal = document.getElementById('removeStudentModal');
        const setFeeDateModal = document.getElementById('setFeeDateModal');
        const setIndividualFeeModal = document.getElementById('setIndividualFeeModal');
        const generateQRCodeModal = document.getElementById('generateQRCodeModal');
        const closeModalButtons = document.querySelectorAll('.close-modal');
        
        // Open add student modal
        document.getElementById('btn-add-student').addEventListener('click', function() {
            if (!isTeacherLoggedIn) {
                alert('Please login as teacher to add students!');
                return;
            }
            addStudentModal.style.display = 'flex';
        });
        
        // Open remove student modal
        document.getElementById('btn-remove-student').addEventListener('click', function() {
            if (!isTeacherLoggedIn) {
                alert('Please login as teacher to remove students!');
                return;
            }
            
            // Populate the student dropdown
            const select = document.getElementById('removeStudentSelect');
            select.innerHTML = '';
            
            const activeClass = document.querySelector('.class-item.active').getAttribute('data-class');
            studentsData[activeClass].forEach(student => {
                const option = document.createElement('option');
                option.value = student.id;
                option.textContent = `${student.name} (${student.id})`;
                select.appendChild(option);
            });
            
            removeStudentModal.style.display = 'flex';
        });
        
        // Open pending approvals
        document.getElementById('btn-pending-approvals').addEventListener('click', function() {
            if (!isTeacherLoggedIn) {
                alert('Please login as teacher to view pending approvals!');
                return;
            }
            
            updatePendingApprovals();
        });
        
        // Open fee management
        document.getElementById('btn-fee-management').addEventListener('click', function() {
            if (!isTeacherLoggedIn) {
                alert('Please login as teacher to manage fees!');
                return;
            }
            
            updateFeeManagement();
        });
        
        // Open face recognition
        document.getElementById('btn-face-recognition').addEventListener('click', function() {
            if (!isTeacherLoggedIn) {
                alert('Please login as teacher to use face recognition!');
                return;
            }
            
            toggleFaceRecognitionSection();
        });
        
        // Open data management
        document.getElementById('btn-data-management').addEventListener('click', function() {
            if (!isTeacherLoggedIn) {
                alert('Please login as teacher to manage data!');
                return;
            }
            
            const dataManagementSection = document.getElementById('dataManagementSection');
            if (dataManagementSection.style.display === 'block') {
                dataManagementSection.style.display = 'none';
            } else {
                dataManagementSection.style.display = 'block';
                updateDataManagement();
            }
        });
        
        // Open set fee date modal
        document.getElementById('setFeeDate').addEventListener('click', function() {
            if (!isTeacherLoggedIn) {
                alert('Please login as teacher to set fee due date!');
                return;
            }
            
            setFeeDateModal.style.display = 'flex';
        });
        
        // Open set individual fees modal
        document.getElementById('setIndividualFees').addEventListener('click', function() {
            if (!isTeacherLoggedIn) {
                alert('Please login as teacher to set individual fees!');
                return;
            }
            
            const activeClass = document.querySelector('.class-item.active').getAttribute('data-class');
            if (studentsData[activeClass].length === 0) {
                alert('No students in this course to set fees for!');
                return;
            }
            
            // Populate the student dropdown
            const select = document.getElementById('individualStudentSelect');
            select.innerHTML = '';
            
            studentsData[activeClass].forEach(student => {
                const option = document.createElement('option');
                option.value = student.id;
                option.textContent = `${student.name} (${student.id}) - Current: â‚¹${student.feeAmount}`;
                select.appendChild(option);
            });
            
            // Set default values
            document.getElementById('individualFeeAmount').value = defaultFeeAmount;
            document.getElementById('individualFeeDueDate').value = feeDueDate || new Date().toISOString().split('T')[0];
            
            setIndividualFeeModal.style.display = 'flex';
        });
        
        // Generate QR Code
        document.getElementById('generateQRCode').addEventListener('click', function() {
            if (!isTeacherLoggedIn) {
                alert('Please login as teacher to generate QR codes!');
                return;
            }
            
            const activeClass = document.querySelector('.class-item.active').getAttribute('data-class');
            if (studentsData[activeClass].length === 0) {
                alert('No students in this course to generate QR codes for!');
                return;
            }
            
            // Populate the student dropdown
            const select = document.getElementById('qrStudentSelect');
            select.innerHTML = '';
            
            studentsData[activeClass].forEach(student => {
                const option = document.createElement('option');
                option.value = student.id;
                option.textContent = `${student.name} (${student.id}) - Fee: â‚¹${student.feeAmount}`;
                select.appendChild(option);
            });
            
            // Set default amount
            document.getElementById('qrAmount').value = defaultFeeAmount;
            
            // Hide QR code container initially
            document.getElementById('qrCodeContainer').style.display = 'none';
            
            generateQRCodeModal.style.display = 'flex';
        });
        
        // Send fee reminders to all
        document.getElementById('sendFeeReminders').addEventListener('click', function() {
            if (!isTeacherLoggedIn) {
                alert('Please login as teacher to send fee reminders!');
                return;
            }
            
            sendFeeRemindersToAll();
        });
        
        // Close modals
        closeModalButtons.forEach(button => {
            button.addEventListener('click', function() {
                addStudentModal.style.display = 'none';
                removeStudentModal.style.display = 'none';
                setFeeDateModal.style.display = 'none';
                setIndividualFeeModal.style.display = 'none';
                generateQRCodeModal.style.display = 'none';
            });
        });
        
        // Set fee due date
        document.getElementById('confirmFeeDate').addEventListener('click', function() {
            setFeeDueDateForAll();
        });
        
        // Set individual fee
        document.getElementById('confirmIndividualFee').addEventListener('click', function() {
            setIndividualFee();
        });
        
        // Generate QR Code
        document.getElementById('generateQRBtn').addEventListener('click', function() {
            const studentId = document.getElementById('qrStudentSelect').value;
            const amount = document.getElementById('qrAmount').value;
            
            if (!studentId || !amount) {
                alert('Please select a student and enter an amount');
                return;
            }
            
            const activeClass = document.querySelector('.class-item.active').getAttribute('data-class');
            const student = studentsData[activeClass].find(s => s.id === studentId);
            
            if (student) {
                // Generate UPI payment URL
                const upiId = 'rajbansh9@oksbi'; // This would be the institute's UPI ID
                const paymentUrl = `upi://pay?pa=${upiId}&pn=Ai%20Tech%20Institute&am=${amount}&cu=INR&tn=Fee%20Payment%20for%20${student.name}`;
                
                // Generate QR Code
                const qrCodeContainer = document.getElementById('qrCode');
                qrCodeContainer.innerHTML = '';
                
                QRCode.toCanvas(qrCodeContainer, paymentUrl, { width: 200 }, function(error) {
                    if (error) {
                        console.error(error);
                        alert('Error generating QR code');
                        return;
                    }
                    
                    // Show payment details
                    const paymentInfo = document.getElementById('paymentInfo');
                    paymentInfo.innerHTML = `
                        <p><strong>Student:</strong> ${student.name}</p>
                        <p><strong>Amount:</strong> â‚¹${amount}</p>
                        <p><strong>Due Date:</strong> ${student.feeDueDate ? new Date(student.feeDueDate).toLocaleDateString() : 'Not set'}</p>
                        <p><strong>Instructions:</strong> Scan this QR code with any UPI app to pay the fee</p>
                        <div class="payment-info">
                            <div>
                                <p><strong>UPI ID:</strong> ${upiId}</p>
                                <p><strong>Institute:</strong> Ai Tech Institute</p>
                            </div>
                        </div>
                    `;
                    
                    // Show QR code container
                    document.getElementById('qrCodeContainer').style.display = 'block';
                    
                    // Send QR code to student email (simulated)
                    const emailMessage = `Dear ${student.name},\n\nPlease find below the QR code for your fee payment of â‚¹${amount}.\n\nScan the QR code with any UPI app to complete your payment.\n\nThank you,\nAi Tech Institute`;
                    
                    console.log(`Email sent to ${student.email} with QR code for payment`);
                    showNotification(`QR code generated and sent to ${student.email}`, 'checkin');
                });
            }
        });
        
        // Add student form submission
        document.getElementById('addStudentForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const name = document.getElementById('studentName').value;
            const rollNo = document.getElementById('studentRoll').value;
            const email = document.getElementById('studentEmail').value;
            const mobile = document.getElementById('studentMobile').value;
            const course = document.getElementById('studentCourse').value;
            const feeAmount = parseFloat(document.getElementById('studentFee').value);
            
            // Generate student ID
            const prefix = course === 'o-level' ? 'OL' : (course === 'adca' ? 'AD' : 'CC');
            const id = prefix + (studentsData[course].length + 1).toString().padStart(3, '0');
            
            // Add student to data
            studentsData[course].push({
                id: id,
                name: name,
                rollNo: rollNo,
                email: email,
                mobile: mobile,
                status: 'absent',
                checkInTime: '',
                checkOutTime: '',
                feeStatus: 'paid',
                feeAmount: feeAmount,
                feeDueDate: feeDueDate || '',
                lastFeePaidDate: new Date().toISOString().split('T')[0]
            });
            
            // If the student is added to the currently active class, refresh the view
            const activeClass = document.querySelector('.class-item.active').getAttribute('data-class');
            if (course === activeClass) {
                generateStudentCards(activeClass);
                updateFeeManagement();
            } else {
                updateStudentCounts();
            }
            
            // Update face recognition student select
            updateStudentSelectForTraining();
            
            // Close modal and reset form
            addStudentModal.style.display = 'none';
            this.reset();
            
            alert(`Student ${name} added successfully with ID: ${id} and fee: â‚¹${feeAmount}`);
        });
        
        // Remove student confirmation
        document.getElementById('confirmRemove').addEventListener('click', function() {
            const select = document.getElementById('removeStudentSelect');
            const studentId = select.value;
            const studentName = select.options[select.selectedIndex].text;
            
            if (confirm(`Are you sure you want to remove ${studentName}?`)) {
                const activeClass = document.querySelector('.class-item.active').getAttribute('data-class');
                studentsData[activeClass] = studentsData[activeClass].filter(student => student.id !== studentId);
                
                // Remove any pending approvals for this student
                pendingApprovals = pendingApprovals.filter(approval => approval.studentId !== studentId);
                updatePendingApprovals();
                
                // Remove captured faces for this student
                delete capturedFaces[studentId];
                
                generateStudentCards(activeClass);
                updateFeeManagement();
                updateStudentSelectForTraining();
                removeStudentModal.style.display = 'none';
                
                alert(`Student ${studentName} removed successfully`);
            }
        });
        
        // View reports functionality
        document.getElementById('btn-view-reports').addEventListener('click', function() {
            if (!isTeacherLoggedIn) {
                alert('Please login as teacher to view reports!');
                return;
            }
            
            const reportContainer = document.getElementById('reportContainer');
            const reportTableBody = document.getElementById('reportTableBody');
            
            // Toggle report visibility
            if (reportContainer.style.display === 'block') {
                reportContainer.style.display = 'none';
            } else {
                reportContainer.style.display = 'block';
                
                // Clear previous data
                reportTableBody.innerHTML = '';
                
                // Get active class
                const activeClass = document.querySelector('.class-item.active').getAttribute('data-class');
                const students = studentsData[activeClass];
                
                // Populate report table
                students.forEach(student => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${student.id}</td>
                        <td>${student.name}</td>
                        <td>${student.status === 'present' ? '<span style="color:green"><i class="fas fa-check-circle"></i> Present</span>' : 
                              student.status === 'checked-out' ? '<span style="color:blue"><i class="fas fa-sign-out-alt"></i> Checked Out</span>' : 
                              student.status === 'pending' ? '<span style="color:orange"><i class="fas fa-clock"></i> Pending</span>' : 
                              '<span style="color:red"><i class="fas fa-times-circle"></i> Absent</span>'}</td>
                        <td>${student.checkInTime || 'Not checked in'}</td>
                        <td>${student.checkOutTime || 'Not checked out'}</td>
                        <td>${student.feeStatus === 'paid' ? '<span style="color:green"><i class="fas fa-check-circle"></i> Paid</span>' : '<span style="color:red"><i class="fas fa-exclamation-triangle"></i> Due</span>'}</td>
                        <td>â‚¹${student.feeAmount}</td>
                    `;
                    reportTableBody.appendChild(row);
                });
            }
        });

        // Data management functions
        document.getElementById('clearAllData').addEventListener('click', function() {
            if (confirm('Are you sure you want to clear ALL student data? This action cannot be undone.')) {
                studentsData = {
                    'o-level': [],
                    'adca': [],
                    'ccc': []
                };
                
                pendingApprovals = [];
                capturedFaces = {};
                
                // Update UI
                const activeClass = document.querySelector('.class-item.active').getAttribute('data-class');
                generateStudentCards(activeClass);
                updateFeeManagement();
                updatePendingApprovals();
                updateStudentSelectForTraining();
                
                alert('All student data has been cleared!');
            }
        });
        
        document.getElementById('exportData').addEventListener('click', function() {
            // Create a JSON string of the data
            const dataToExport = {
                studentsData: studentsData,
                capturedFaces: capturedFaces
            };
            const dataStr = JSON.stringify(dataToExport, null, 2);
            
            // Create a blob and download link
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'student_data.json';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            alert('Student data exported successfully!');
        });
        
        document.getElementById('importData').addEventListener('click', function() {
            // Create file input element
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const importedData = JSON.parse(e.target.result);
                        
                        // Validate the imported data structure
                        if (importedData.studentsData && importedData.studentsData['o-level'] && importedData.studentsData['adca'] && importedData.studentsData['ccc']) {
                            studentsData = importedData.studentsData;
                            capturedFaces = importedData.capturedFaces || {};
                            
                            // Update UI
                            const activeClass = document.querySelector('.class-item.active').getAttribute('data-class');
                            generateStudentCards(activeClass);
                            updateFeeManagement();
                            updatePendingApprovals();
                            updateStudentSelectForTraining();
                            
                            alert('Student data imported successfully!');
                        } else {
                            alert('Invalid data format. Please select a valid student data file.');
                        }
                    } catch (error) {
                        alert('Error importing data: ' + error.message);
                    }
                };
                
                reader.readAsText(file);
            };
            
            input.click();
        });
        
        function updateDataManagement() {
            const dataList = document.getElementById('dataList');
            dataList.innerHTML = '';
            
            let totalStudents = 0;
            Object.keys(studentsData).forEach(classId => {
                totalStudents += studentsData[classId].length;
            });
            
            const dataInfo = document.createElement('div');
            dataInfo.className = 'fee-item';
            dataInfo.innerHTML = `
                <div>
                    <strong>Data Summary</strong>
                    <div>Total Students: ${totalStudents}</div>
                    <div>O Level Students: ${studentsData['o-level'].length}</div>
                    <div>ADCA Students: ${studentsData['adca'].length}</div>
                    <div>CCC Students: ${studentsData['ccc'].length}</div>
                    <div>Pending Approvals: ${pendingApprovals.length}</div>
                    <div>Students with Face Data: ${Object.keys(capturedFaces).length}</div>
                </div>
            `;
            dataList.appendChild(dataInfo);
        }

        // Teacher control buttons
        document.querySelectorAll('.control-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                // Remove active class from all buttons
                document.querySelectorAll('.control-btn').forEach(b => {
                    b.classList.remove('active');
                });
                
                // Add active class to clicked button
                this.classList.add('active');
            });
        });

        // Face Recognition Functions
        function initializeFaceRecognition() {
            try {
                // Initialize captured faces object
                Object.keys(studentsData).forEach(classId => {
                    studentsData[classId].forEach(student => {
                        if (!capturedFaces[student.id]) {
                            capturedFaces[student.id] = [];
                        }
                    });
                });
                
                // Populate student select for training
                updateStudentSelectForTraining();
                
                console.log('Face recognition initialized successfully');
                
            } catch (error) {
                console.error('Error initializing face recognition:', error);
                alert('Face recognition could not be initialized. Please check browser compatibility.');
            }
        }
        
        // Start face recognition
        async function startFaceRecognition() {
            try {
                // Get access to camera
                videoStream = await navigator.mediaDevices.getUserMedia({ 
                    video: { 
                        width: 640, 
                        height: 480,
                        facingMode: 'user'
                    } 
                });
                
                const videoElement = document.getElementById('videoElement');
                videoElement.srcObject = videoStream;
                
                // Enable buttons
                document.getElementById('startFaceRecognition').disabled = true;
                document.getElementById('stopFaceRecognition').disabled = false;
                
                // Update status
                document.getElementById('faceRecognitionStatus').textContent = 'Face recognition active - Looking for faces...';
                document.getElementById('faceRecognitionStatus').className = 'face-recognition-status recognizing';
                
                faceRecognitionActive = true;
                
                // Start face detection simulation (since we don't have actual face-api.js)
                startFaceDetectionSimulation();
                
            } catch (error) {
                console.error('Error accessing camera:', error);
                alert('Could not access camera. Please ensure camera permissions are granted.');
            }
        }
        
        // Stop face recognition
        function stopFaceRecognition() {
            faceRecognitionActive = false;
            
            // Stop video stream
            if (videoStream) {
                videoStream.getTracks().forEach(track => track.stop());
                videoStream = null;
            }
            
            // Clear detection interval
            if (faceDetectionInterval) {
                clearInterval(faceDetectionInterval);
                faceDetectionInterval = null;
            }
            
            // Clear video element
            const videoElement = document.getElementById('videoElement');
            videoElement.srcObject = null;
            
            // Clear overlay
            const overlay = document.getElementById('overlay');
            const context = overlay.getContext('2d');
            context.clearRect(0, 0, overlay.width, overlay.height);
            
            // Update buttons
            document.getElementById('startFaceRecognition').disabled = false;
            document.getElementById('stopFaceRecognition').disabled = true;
            
            // Update status
            document.getElementById('faceRecognitionStatus').textContent = 'Face recognition stopped';
            document.getElementById('faceRecognitionStatus').className = 'face-recognition-status';
        }
        
        // Simulate face detection (since we don't have actual face-api.js)
        function startFaceDetectionSimulation() {
            const videoElement = document.getElementById('videoElement');
            const overlay = document.getElementById('overlay');
            
            // Set overlay dimensions
            overlay.width = videoElement.videoWidth || 640;
            overlay.height = videoElement.videoHeight || 480;
            
            faceDetectionInterval = setInterval(() => {
                if (!faceRecognitionActive) return;
                
                try {
                    // Clear overlay
                    const context = overlay.getContext('2d');
                    context.clearRect(0, 0, overlay.width, overlay.height);
                    
                    // Simulate face detection with random results
                    if (Math.random() < 0.3) { // 30% chance of detecting a face
                        const studentIds = Object.keys(capturedFaces).filter(id => capturedFaces[id].length > 0);
                        if (studentIds.length > 0) {
                            const randomStudentId = studentIds[Math.floor(Math.random() * studentIds.length)];
                            recognizeStudent(randomStudentId);
                            
                            // Draw a simulated detection box
                            context.strokeStyle = '#00ff00';
                            context.lineWidth = 2;
                            context.strokeRect(100, 100, 200, 200);
                            
                            // Draw label
                            context.fillStyle = '#00ff00';
                            context.font = '16px Arial';
                            let studentName = 'Unknown';
                            Object.keys(studentsData).forEach(classId => {
                                const student = studentsData[classId].find(s => s.id === randomStudentId);
                                if (student) studentName = student.name;
                            });
                            context.fillText(studentName, 100, 90);
                        }
                    }
                    
                } catch (error) {
                    console.error('Error in face detection simulation:', error);
                }
            }, 2000); // Check every 2 seconds
        }
        
        // Recognize student and mark attendance
        function recognizeStudent(studentId) {
            // Find student across all classes
            let student = null;
            let studentClass = null;
            
            Object.keys(studentsData).forEach(classId => {
                const foundStudent = studentsData[classId].find(s => s.id === studentId);
                if (foundStudent) {
                    student = foundStudent;
                    studentClass = classId;
                }
            });
            
            if (student) {
                // Check if student is already present or checked out
                if (student.status === 'absent') {
                    // Mark check-in
                    markCheckIn(student.id);
                    
                    // Update status
                    document.getElementById('faceRecognitionStatus').textContent = `Recognized: ${student.name} - Checked in`;
                    document.getElementById('faceRecognitionStatus').className = 'face-recognition-status success';
                    
                    // Reset status after 3 seconds
                    setTimeout(() => {
                        if (faceRecognitionActive) {
                            document.getElementById('faceRecognitionStatus').textContent = 'Face recognition active - Looking for faces...';
                            document.getElementById('faceRecognitionStatus').className = 'face-recognition-status recognizing';
                        }
                    }, 3000);
                } else if (student.status === 'present') {
                    // Mark check-out
                    markCheckOut(student.id);
                    
                    // Update status
                    document.getElementById('faceRecognitionStatus').textContent = `Recognized: ${student.name} - Checked out`;
                    document.getElementById('faceRecognitionStatus').className = 'face-recognition-status success';
                    
                    // Reset status after 3 seconds
                    setTimeout(() => {
                        if (faceRecognitionActive) {
                            document.getElementById('faceRecognitionStatus').textContent = 'Face recognition active - Looking for faces...';
                            document.getElementById('faceRecognitionStatus').className = 'face-recognition-status recognizing';
                        }
                    }, 3000);
                } else {
                    // Student is already checked out or pending
                    document.getElementById('faceRecognitionStatus').textContent = `Recognized: ${student.name} - Already ${student.status}`;
                    document.getElementById('faceRecognitionStatus').className = 'face-recognition-status';
                    
                    // Reset status after 3 seconds
                    setTimeout(() => {
                        if (faceRecognitionActive) {
                            document.getElementById('faceRecognitionStatus').textContent = 'Face recognition active - Looking for faces...';
                            document.getElementById('faceRecognitionStatus').className = 'face-recognition-status recognizing';
                        }
                    }, 3000);
                }
            }
        }
        
        // Capture face for training
        async function captureFace() {
            const studentSelect = document.getElementById('studentSelectForTraining');
            const studentId = studentSelect.value;
            
            if (!studentId) {
                alert('Please select a student first');
                return;
            }
            
            if (!videoStream) {
                alert('Please start face recognition first');
                return;
            }
            
            try {
                const videoElement = document.getElementById('videoElement');
                
                // Create canvas to capture face
                const canvas = document.createElement('canvas');
                const context = canvas.getContext('2d');
                canvas.width = videoElement.videoWidth || 640;
                canvas.height = videoElement.videoHeight || 480;
                
                // Draw video frame to canvas
                context.drawImage(videoElement, 0, 0, canvas.width, canvas.height);
                
                // Extract face region (simulated)
                const faceCanvas = document.createElement('canvas');
                const faceContext = faceCanvas.getContext('2d');
                faceCanvas.width = 200;
                faceCanvas.height = 200;
                
                // Draw a centered portion of the video as the "face"
                faceContext.drawImage(
                    canvas, 
                    canvas.width/2 - 100, canvas.height/2 - 100, 200, 200,
                    0, 0, 200, 200
                );
                
                // Convert to data URL
                const faceDataUrl = faceCanvas.toDataURL('image/jpeg', 0.8);
                
                // Store face data
                if (!capturedFaces[studentId]) {
                    capturedFaces[studentId] = [];
                }
                
                capturedFaces[studentId].push({
                    descriptor: 'simulated_descriptor_' + Date.now(), // Simulated descriptor
                    image: faceDataUrl
                });
                
                // Update UI
                updateCapturedFacesDisplay(studentId);
                
                alert(`Face captured for ${studentSelect.options[studentSelect.selectedIndex].text}. Captured ${capturedFaces[studentId].length} images.`);
                
            } catch (error) {
                console.error('Error capturing face:', error);
                alert('Error capturing face. Please try again.');
            }
        }
        
        // Update captured faces display
        function updateCapturedFacesDisplay(studentId) {
            const capturedFacesContainer = document.getElementById('capturedFaces');
            capturedFacesContainer.innerHTML = '';
            
            if (capturedFaces[studentId] && capturedFaces[studentId].length > 0) {
                capturedFaces[studentId].forEach((face, index) => {
                    const faceElement = document.createElement('div');
                    faceElement.className = 'captured-face';
                    faceElement.innerHTML = `
                        <img src="${face.image}" alt="Captured face">
                        <button class="remove-face" data-student="${studentId}" data-index="${index}">&times;</button>
                    `;
                    capturedFacesContainer.appendChild(faceElement);
                });
                
                // Add event listeners to remove buttons
                document.querySelectorAll('.remove-face').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const studentId = this.getAttribute('data-student');
                        const index = parseInt(this.getAttribute('data-index'));
                        removeCapturedFace(studentId, index);
                    });
                });
            }
        }
        
        // Remove captured face
        function removeCapturedFace(studentId, index) {
            if (capturedFaces[studentId] && capturedFaces[studentId][index]) {
                capturedFaces[studentId].splice(index, 1);
                updateCapturedFacesDisplay(studentId);
            }
        }
        
        // Clear all faces for a student
        function clearAllFaces() {
            const studentSelect = document.getElementById('studentSelectForTraining');
            const studentId = studentSelect.value;
            
            if (!studentId) {
                alert('Please select a student first');
                return;
            }
            
            if (confirm('Are you sure you want to clear all captured faces for this student?')) {
                capturedFaces[studentId] = [];
                updateCapturedFacesDisplay(studentId);
                alert('All captured faces cleared for this student.');
            }
        }
        
        // Train face recognition model
        async function trainFaceModel() {
            try {
                // Check if we have enough face data
                let totalFaces = 0;
                Object.keys(capturedFaces).forEach(studentId => {
                    totalFaces += capturedFaces[studentId].length;
                });
                
                if (totalFaces < 1) {
                    alert('Please capture at least 1 face image before training the model.');
                    return;
                }
                
                // Update status
                document.getElementById('faceRecognitionStatus').textContent = 'Training face recognition model...';
                document.getElementById('faceRecognitionStatus').className = 'face-recognition-status recognizing';
                
                // Simulate training delay
                setTimeout(() => {
                    // Update status
                    document.getElementById('faceRecognitionStatus').textContent = `Face recognition model trained with ${Object.keys(capturedFaces).filter(id => capturedFaces[id].length > 0).length} students`;
                    document.getElementById('faceRecognitionStatus').className = 'face-recognition-status success';
                    
                    alert(`Face recognition model trained successfully with ${Object.keys(capturedFaces).filter(id => capturedFaces[id].length > 0).length} students!`);
                }, 2000);
                
            } catch (error) {
                console.error('Error training face model:', error);
                document.getElementById('faceRecognitionStatus').textContent = 'Error training face recognition model';
                document.getElementById('faceRecognitionStatus').className = 'face-recognition-status error';
                alert('Error training face recognition model. Please try again.');
            }
        }
        
        // Update student select for training
        function updateStudentSelectForTraining() {
            const select = document.getElementById('studentSelectForTraining');
            select.innerHTML = '';
            
            // Add default option
            const defaultOption = document.createElement('option');
            defaultOption.value = '';
            defaultOption.textContent = 'Select a student';
            select.appendChild(defaultOption);
            
            // Add students from all classes
            Object.keys(studentsData).forEach(classId => {
                studentsData[classId].forEach(student => {
                    const option = document.createElement('option');
                    option.value = student.id;
                    option.textContent = `${student.name} (${student.id}) - ${classId}`;
                    select.appendChild(option);
                });
            });
            
            // Add change event listener
            select.addEventListener('change', function() {
                const studentId = this.value;
                if (studentId) {
                    updateCapturedFacesDisplay(studentId);
                } else {
                    document.getElementById('capturedFaces').innerHTML = '';
                }
            });
        }
        
        // Toggle face recognition section
        function toggleFaceRecognitionSection() {
            const faceRecognitionSection = document.getElementById('faceRecognitionSection');
            if (faceRecognitionSection.style.display === 'block') {
                faceRecognitionSection.style.display = 'none';
                // Stop face recognition if active
                if (faceRecognitionActive) {
                    stopFaceRecognition();
                }
            } else {
                faceRecognitionSection.style.display = 'block';
                // Initialize face recognition if not already done
                if (Object.keys(capturedFaces).length === 0) {
                    initializeFaceRecognition();
                }
            }
        }
        
        // Add event listeners for face recognition controls
        document.getElementById('startFaceRecognition').addEventListener('click', startFaceRecognition);
        document.getElementById('stopFaceRecognition').addEventListener('click', stopFaceRecognition);
        document.getElementById('trainFaceModel').addEventListener('click', trainFaceModel);
        document.getElementById('captureFace').addEventListener('click', captureFace);
        document.getElementById('clearFaces').addEventListener('click', clearAllFaces);

        // Initialize with 'O' Level course
        generateStudentCards('o-level');
        initializeFeeManagement();
    </script>
</body>
</html>